{"componentChunkName":"component---src-templates-blog-post-js","path":"/design-patterns-strategy-patterns/","result":{"data":{"site":{"siteMetadata":{"title":"Attila","cover":"/background/1.jpg","description":"Thoughts, stories and ideas.","keywords":["烈风裘的博客","X-Blog","Attila","Gatsby","前端成长记录"],"tagCover":"/background/5.jpg","archiveCover":"/background/escape-flight.png","siteUrl":"https://xiangst0816.github.io/blog","logo":"","navigation":true,"subscribe":true}},"allAuthorJson":{"totalCount":2,"edges":[{"node":{"id":"烈风裘","bio":"一往无前, 直到云开雾散!","avatar":"/avatar/me.jpeg","cover":"/background/photo-1503197979108-c824168d51a8.jpeg","github":"https://github.com/xiangsongtao","twitter":"","zhihu":"","weibo":"","facebook":"","website":"https://xiangsongtao.github.io/blog/","location":"HangZhou, China"}},{"node":{"id":"WALL-E","bio":"还有要清理的吗?","avatar":"/avatar/cleaner.jpg","cover":"","github":null,"twitter":null,"zhihu":null,"weibo":null,"facebook":null,"website":null,"location":"Earth"}}]},"master":{"id":"烈风裘","bio":"一往无前, 直到云开雾散!","avatar":"/avatar/me.jpeg","cover":"/background/photo-1503197979108-c824168d51a8.jpeg","github":"https://github.com/xiangsongtao","twitter":"","zhihu":"","weibo":"","facebook":"","website":"https://xiangsongtao.github.io/blog/","location":"HangZhou, China"},"currentPost":{"html":"<h2 id=\"背景\" style=\"position:relative;\"><a href=\"#%E8%83%8C%E6%99%AF\" aria-label=\"背景 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>背景</h2>\n<p>在现实生活中，存在实现一个目标有多种策略可供选择的情况，比如：出门旅行的多种目的地、乘车方式等；超市打折促销的方式；吃饭做菜时，土豆丝的多种做法等；</p>\n<p><strong>在软件开发过程中也会遇到此类问题（模式），当实现某个功能存在多种策略时，我们根据环境（Context）的不同，选择指定的策略</strong>。比如进行排序，有冒泡排序、选择排序、插入排序、二叉树排序等。</p>\n<blockquote>\n<p>反例介绍</p>\n</blockquote>\n<p>当代码中存在根据环境进行多重if-else判断时，增加策略会导致源码有较大修改，导致条件语句结构复杂不移维护，违背<strong>开闭原则</strong>。此时采用策略模式就能很好的解决该问题。</p>\n<h2 id=\"定义及特点\" style=\"position:relative;\"><a href=\"#%E5%AE%9A%E4%B9%89%E5%8F%8A%E7%89%B9%E7%82%B9\" aria-label=\"定义及特点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>定义及特点</h2>\n<p>策略模式（Strategy）：该模式定义了一些列算法，并将算法封装起来，使他们能够互相替换，且算法的变化不影响使用算法的用户（Context）。策略模式属于对象行为模式，将算法具体实现进行封装（把<strong>使用算法</strong>和<strong>算法实现</strong>分割开来，<strong>算法实现</strong>委派不同的对象进行管理）。</p>\n<h3 id=\"1-主要优点\" style=\"position:relative;\"><a href=\"#1-%E4%B8%BB%E8%A6%81%E4%BC%98%E7%82%B9\" aria-label=\"1 主要优点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 主要优点</h3>\n<ol>\n<li>多重条件语句不易维护，而使用策略模式可以避免使用多重条件语句。</li>\n<li>策略模式提供了一系列的可供重用的算法族，恰当使用继承可以把算法族的公共代码转移到父类里面，从而避免重复的代码。</li>\n<li>策略模式可以提供相同行为的不同实现，客户可以根据不同时间或空间要求选择不同的。</li>\n<li>策略模式提供了对开闭原则的完美支持，可以在不修改原代码的情况下，灵活增加新算法。</li>\n<li>策略模式把算法的使用放到环境类中，而算法的实现移到具体策略类中，实现了二者的分离。</li>\n</ol>\n<h3 id=\"2-主要缺点\" style=\"position:relative;\"><a href=\"#2-%E4%B8%BB%E8%A6%81%E7%BC%BA%E7%82%B9\" aria-label=\"2 主要缺点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 主要缺点</h3>\n<ol>\n<li>客户端必须理解所有策略算法的区别，以便适时选择恰当的算法类。</li>\n<li>策略模式造成很多的策略类。</li>\n</ol>\n<h2 id=\"结构及实现\" style=\"position:relative;\"><a href=\"#%E7%BB%93%E6%9E%84%E5%8F%8A%E5%AE%9E%E7%8E%B0\" aria-label=\"结构及实现 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>结构及实现</h2>\n<p>策略模式是准备一组算法，并将这组算法封装到一系列的<strong>策略类</strong>里面，作为一个抽象策略类的子类。<strong>策略模式的重心不是如何实现算法，而是如何组织这些算法</strong>，从而让程序结构更加灵活，具有更好的维护性和扩展性，现在我们来分析其基本结构和实现方法。</p>\n<h3 id=\"1-模式的结构\" style=\"position:relative;\"><a href=\"#1-%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84\" aria-label=\"1 模式的结构 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 模式的结构</h3>\n<p>策略模式的主要角色如下。</p>\n<ol>\n<li>抽象策略（Strategy）类：定义了一个公共接口，各种不同的算法以不同的方式实现这个接口，环境角色使用这个接口调用不同的算法，一般使用接口或抽象类实现。</li>\n<li>具体策略（Concrete Strategy）类：实现了抽象策略定义的接口，提供具体的算法实现。</li>\n<li>环境（Context）类：持有一个策略类的引用，最终给客户端调用。</li>\n</ol>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 840px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.047619047619044%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABO0lEQVQoz32S4Y6CQAyEef8H45dBjAkqipigoKKCAgZQ6eXrZQ1nOJtMdtPtzky7a6VpKvv9Xna7na51XUtVVbpPkkTzrI/HQ7quk9fr9Qf9HHtrOp3KeDwWx3FkMpmIEXBdVzEajfSsKAohzMX/YMVx/HYRRZFexOF6vZbtdivH41EF7vf7oEOcg+fz+UsovSDJRUDxZ+AegfP5LJ7nqWhZlmoiyzIltowSZGC5XMp8Ptfc7XZTIHC9XmWz2chsNpPVaqWEOD+dTnK5XFRECbFJ0GYYhlocBIGOgFzbtipEMY5s21YwV0Ad7iB9E5rZcLH/coQ5J/I8V1e0DSAxv8KMyfr2Yv3hE4fDQRaLhfi+r27pBFKEICSsIYIhYlbmxcPQJuSsOGW+uNRX/ubwE7RnvkgfTdPorKn5AfCu/180l8WjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"策略模式\"\n        title=\"策略模式\"\n        src=\"/blog/static/6c744d11a41b9f1a792f9b67d6b3de7b/f88f5/image-20191004145847644.png\"\n        srcset=\"/blog/static/6c744d11a41b9f1a792f9b67d6b3de7b/e1650/image-20191004145847644.png 210w,\n/blog/static/6c744d11a41b9f1a792f9b67d6b3de7b/8cae7/image-20191004145847644.png 420w,\n/blog/static/6c744d11a41b9f1a792f9b67d6b3de7b/f88f5/image-20191004145847644.png 840w,\n/blog/static/6c744d11a41b9f1a792f9b67d6b3de7b/57a2b/image-20191004145847644.png 1260w,\n/blog/static/6c744d11a41b9f1a792f9b67d6b3de7b/609d5/image-20191004145847644.png 1292w\"\n        sizes=\"(max-width: 840px) 100vw, 840px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">策略模式</figcaption>\n  </figure></p>\n<h3 id=\"2-模式的实现\" style=\"position:relative;\"><a href=\"#2-%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9E%E7%8E%B0\" aria-label=\"2 模式的实现 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 模式的实现</h3>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">IStrategy</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">strategyMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Context</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> strategy<span class=\"token operator\">:</span> IStrategy<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">setStrategy</span><span class=\"token punctuation\">(</span>strategy<span class=\"token operator\">:</span> IStrategy<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>strategy <span class=\"token operator\">=</span> strategy<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">getStrategy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> IStrategy <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>strategy<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">strategyMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>strategy<span class=\"token punctuation\">.</span><span class=\"token function\">strategyMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ConcreteStrategyA</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IStrategy</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">strategyMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'具体策略A的策略方法被访问！'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ConcreteStrategyB</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IStrategy</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">strategyMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'具体策略B的策略方法被访问！'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> context <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Context</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> csa <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcreteStrategyA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> csb <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcreteStrategyB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">setStrategy</span><span class=\"token punctuation\">(</span>csa<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">strategyMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'------------'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">setStrategy</span><span class=\"token punctuation\">(</span>csb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">strategyMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 具体策略A的策略方法被访问！</span>\n<span class=\"token comment\">// ------------</span>\n<span class=\"token comment\">// 具体策略B的策略方法被访问！</span></code></pre></div>\n<h2 id=\"应用场景\" style=\"position:relative;\"><a href=\"#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF\" aria-label=\"应用场景 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>应用场景</h2>\n<p>策略模式在很多地方用到，如 JavaSE 中的容器布局管理就是一个典型的实例，Java SE 中的每个容器都存在多种布局供用户选择。在程序设计中，通常在以下几种情况中使用策略模式较多。</p>\n<ol>\n<li>一个系统需要动态地在几种算法中选择一种时，可将每个算法封装到策略类中。</li>\n<li>一个类定义了多种行为，并且这些行为在这个类的操作中以多个条件语句的形式出现，可将每个条件分支移入它们各自的策略类中以代替这些条件语句。</li>\n<li>系统中各算法彼此完全独立，且要求对客户隐藏具体算法的实现细节时。</li>\n<li>系统要求使用算法的客户不应该知道其操作的数据时，可使用策略模式来隐藏与算法相关的<strong>数据结构</strong>。</li>\n<li>多个类只区别在表现行为不同，可以使用策略模式，在运行时动态选择具体要执行的行为</li>\n</ol>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 840px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.523809523809526%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABNklEQVQoz4WS6YrCQBCE5/0fLSj4QzDmUCMmXqh459DU8jXMErLiDhTT6c7UdFWPe71eut/vOp/PejweKstSl8vFcsTX69VqVVXp/X6rbVvbP4Gaez6fSpJEw+HQ9jzPNRqNLC6KQuPxWIPBQOv1WlzOoW9wdJFlmZbLpeI4thiyxWKhNE01m82stlqt/nTEBV2Qc112kshG5u12U13X6i/s2O/3OhwOCsNQ8/nc7DmdTlb7JYSdhVd0ttlsLM83HmINB7EEBViBIv7b7XYGSJ0noiOkIXUymWi73RoJoOumaQzk8TsIAusQUkDXRtiVSzddmeT7MXZwKZ5CwjfwL8N5uf7At2fBOh6PiqJI0+nUBshQaQIyiN2n0fsL+jk/FD80dmygDin2uP/eVR/+IPaArs/UfgDypwIdZW7LWgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"策略模式示例\"\n        title=\"策略模式示例\"\n        src=\"/blog/static/c79057e6719d12bebcb6c6422ae3c05f/f88f5/image-20191004145929189.png\"\n        srcset=\"/blog/static/c79057e6719d12bebcb6c6422ae3c05f/e1650/image-20191004145929189.png 210w,\n/blog/static/c79057e6719d12bebcb6c6422ae3c05f/8cae7/image-20191004145929189.png 420w,\n/blog/static/c79057e6719d12bebcb6c6422ae3c05f/f88f5/image-20191004145929189.png 840w,\n/blog/static/c79057e6719d12bebcb6c6422ae3c05f/57a2b/image-20191004145929189.png 1260w,\n/blog/static/c79057e6719d12bebcb6c6422ae3c05f/04a4c/image-20191004145929189.png 1500w\"\n        sizes=\"(max-width: 840px) 100vw, 840px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">策略模式示例</figcaption>\n  </figure></p>\n<h2 id=\"拓展\" style=\"position:relative;\"><a href=\"#%E6%8B%93%E5%B1%95\" aria-label=\"拓展 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>拓展</h2>\n<p>在一个使用策略模式的系统中，当存在的策略很多时，客户端管理所有策略算法将变得很复杂，如果在环境类中使用<strong>策略工厂模式</strong>来管理这些策略类将大大减少客户端的工作复杂度，其结构图如图所示。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 840px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.857142857142854%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABNElEQVQoz4WSa8uCQBCF9///M0HNLAk/WHY1K81b2kU7cQbmRSJ4Bw5ru+yZOc9mTqcTjscj9vs9rtcrHo8HLpeL7B0OB5zPZ7xeL7zfbwzDIKt+q3SPMp7nYTKZwLZtLBYLFEWB2WwG13XhOA7m8znqugar7/s/k3FxX89MlmVQcZqqqpCmKfI8F3Pq+XzKRRpzeioIAmkchqHcKcsSTdPAjDsx/nQ6Rdu2uN/v6LpOEHC93W7Y7XbwfV9MmIwp+JtoOBAbGmVAfsvlElEUCU9ORjPyoxiJXC3LEiM2pulqtZJBOKVMqIB/1Rg2i9E5BS9SasLpmYrn5terfb+eNqRBHMei9XotCDabjTDlGZOY8d9hbPS9xyJ48tputyIi4JokiTAkazOO9Z/4UIxFnspWpbw/fWKxArA+jnEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"策略工厂模式\"\n        title=\"策略工厂模式\"\n        src=\"/blog/static/e507711141bc3b2b7370af7d2b568c8c/f88f5/image-20191004145945184.png\"\n        srcset=\"/blog/static/e507711141bc3b2b7370af7d2b568c8c/e1650/image-20191004145945184.png 210w,\n/blog/static/e507711141bc3b2b7370af7d2b568c8c/8cae7/image-20191004145945184.png 420w,\n/blog/static/e507711141bc3b2b7370af7d2b568c8c/f88f5/image-20191004145945184.png 840w,\n/blog/static/e507711141bc3b2b7370af7d2b568c8c/57a2b/image-20191004145945184.png 1260w,\n/blog/static/e507711141bc3b2b7370af7d2b568c8c/b5d14/image-20191004145945184.png 1680w,\n/blog/static/e507711141bc3b2b7370af7d2b568c8c/f6042/image-20191004145945184.png 1720w\"\n        sizes=\"(max-width: 840px) 100vw, 840px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">策略工厂模式</figcaption>\n  </figure></p>","timeToRead":4,"wordCount":{"paragraphs":36,"sentences":36,"words":122},"fields":{"slug":"/design-patterns-strategy-patterns/","relativePath":"2019/2019-10-04---design-patterns-strategy-patterns/index.md"},"excerpt":"…","frontmatter":{"title":"设计模式「策略模式」","date":"04 Oct 2019","tags":["设计模式"],"cover":"","comments":true,"author":"烈风裘"}},"nextPost":{"html":"<h2 id=\"安装\" style=\"position:relative;\"><a href=\"#%E5%AE%89%E8%A3%85\" aria-label=\"安装 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安装</h2>\n<p>全局安装，<a href=\"https://npm.taobao.org\" target=\"_target\" rel=\"nofollow\">详情</a>：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm install tnpm -g --registry=https://registry.npm.taobao.org</code></pre></div>\n<h2 id=\"使用问题\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98\" aria-label=\"使用问题 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用问题</h2>\n<p>cnpm是使用软连方式安装，所以在IDE使用时，会遇到两个问题：</p>\n<ol>\n<li>某些 IDE 无法正确识别软链，会导致循环索引。</li>\n<li><code class=\"language-text\">node_modules</code> 目录下同时存在软链，不方便查看。</li>\n</ol>\n<p>第一点，安装 <a href=\"https://www.npmjs.com/package/webstorm-disable-index\" target=\"_target\" rel=\"nofollow\">webstorm-disable-index</a> 这个依赖包即可。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ tnpm i webstorm-disable-index --save-dev\n$ ls .idea/</code></pre></div>\n<p>第二点，你可以在 <code class=\"language-text\">VSCode</code> 配置：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;files.exclude&quot;: {\n  &quot;**/node_modules/_*@*&quot;: true,\n},</code></pre></div>\n<p>在 <code class=\"language-text\">WebStorm</code> 配置 <code class=\"language-text\">File Types</code> 的 <code class=\"language-text\">Ignore</code> 增加 <code class=\"language-text\">_*@*;</code> 即可。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 840px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.14285714285715%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAB7UlEQVQ4y42TSY/TQBBG/YuSyWbHcbfd7va+O3a2gUHA3FkkJC5ckBA3fvNHdSeMEJNBOTyV3S6XXV2vrSjfIiF8WcL1UyzdEEGoIKQC8wVWjovFyjHMl/Z/mS1sWGV3Qt4cwMIKQdRApi32h5Nh3B+Q5aX5wC34QsKSaY+yPSJMukvRCl0/YBj36IcdVJzC44H5Ww0PQrB/+bNO0VJZj258gMqobVVDxLUpNOyOhqYbEKUFYsIPIyogX8YPYYVJi2Z4jao7QhcX9IdSCgjBEV4IfM/AuQvOXoaxDSy2+4H68Rf44SdW7Xesm68oTl/QvPkGt/4Eu/gAp/xInOP6KvSs+ox19kgtl69Qj+/BohE83lPcQhU7xNURG9XBU/0NnPM2NANLJg22+wfk1WjaDWQOxjk8Ri36nNq8EcrV75mh1P09tI8+aaN95LTB56mFJj5HPuX8jZlyQcq0NBTtoNFGXbwT0iRoZZ7BGMGvPjMeDoe30ILroiKqycstTX5HawPSskFWtUgJHfOqQbp9h7S9pxNWIinqS05j9LJEXNBFCRnn4CIm2yNjvOHKadBHMlA5bU1ipNcfkFGMIC7BFBXceC4cx4aztrF2HbiETfd38wWmdzPD5BKfrqdTTAids1iuMJvNMZktMZ2v8BuaPdCd6+r9yAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"webstorm ignore 49004433\"\n        title=\"webstorm ignore 49004433\"\n        src=\"/blog/static/f5f380733d592fe156168a80a677be49/f88f5/webstorm_ignore.49004433.png\"\n        srcset=\"/blog/static/f5f380733d592fe156168a80a677be49/e1650/webstorm_ignore.49004433.png 210w,\n/blog/static/f5f380733d592fe156168a80a677be49/8cae7/webstorm_ignore.49004433.png 420w,\n/blog/static/f5f380733d592fe156168a80a677be49/f88f5/webstorm_ignore.49004433.png 840w,\n/blog/static/f5f380733d592fe156168a80a677be49/57a2b/webstorm_ignore.49004433.png 1260w,\n/blog/static/f5f380733d592fe156168a80a677be49/b5d14/webstorm_ignore.49004433.png 1680w,\n/blog/static/f5f380733d592fe156168a80a677be49/4636e/webstorm_ignore.49004433.png 2000w\"\n        sizes=\"(max-width: 840px) 100vw, 840px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>","timeToRead":1,"wordCount":{"paragraphs":9,"sentences":9,"words":25},"fields":{"slug":"/cnpm-shi-yong-zong-jie/","relativePath":"2019/2019-9-22---cnpm-shi-yong-zong-jie/index.md"},"excerpt":"安装 全局安装，详情： 使用问题 cnpm是使用软连方式安装，所以在IDE使用时，会遇到两个问题： 某些 IDE 无法正确识别软链，会导致循环索引。  目录下同时存在软链，不方便查看。 第一点，安装 webstorm…","frontmatter":{"title":"cnpm使用总结","date":"22 Sep 2019","tags":["未归档"],"cover":"","comments":true,"author":"烈风裘"}},"prevPost":{"html":"<h3 id=\"1-请介绍一下node里的模块是什么？\" style=\"position:relative;\"><a href=\"#1-%E8%AF%B7%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8Bnode%E9%87%8C%E7%9A%84%E6%A8%A1%E5%9D%97%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F\" aria-label=\"1 请介绍一下node里的模块是什么？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1 请介绍一下node里的模块是什么？</h3>\n<p>Node中，每个文件模块都是一个对象，它的接口 <code class=\"language-text\">NodeModule</code> 定义如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">NodeModule</span> <span class=\"token punctuation\">{</span>\n    exports<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">require</span><span class=\"token operator\">:</span> NodeRequireFunction<span class=\"token punctuation\">;</span>\n    id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    filename<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    loaded<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n    parent<span class=\"token operator\">:</span> NodeModule <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    children<span class=\"token operator\">:</span> NodeModule<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    paths<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">NodeRequireFunction</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* tslint:disable-next-line:callable-types */</span>\n    <span class=\"token punctuation\">(</span>id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Module</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parent <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parent <span class=\"token operator\">&amp;&amp;</span> parent<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    parent<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filename <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loaded <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>children <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">module</span><span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> Module<span class=\"token punctuation\">;</span></code></pre></div>\n<p>所有的模块都是 Module 的实例。module.exports 的定义就在这里体现，<strong>默认是空对象</strong>！</p>\n<p>这里的module.js引用subModules.js文件，打印module.js中的的 <code class=\"language-text\">module</code> 变量的结果：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Module <span class=\"token punctuation\">{</span>\n  id<span class=\"token operator\">:</span> <span class=\"token string\">'.'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 当前的ID</span>\n  path<span class=\"token operator\">:</span> <span class=\"token string\">'/Users/Hsiang/tp/config'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 文件Path</span>\n  exports<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 导出的方法</span>\n  parent<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  filename<span class=\"token operator\">:</span> <span class=\"token string\">'/Users/Hsiang/tp/config/module.js'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 当前模块的文件名</span>\n  loaded<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 是否加载</span>\n  children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">// 依赖的模块</span>\n    Module <span class=\"token punctuation\">{</span>\n      id<span class=\"token operator\">:</span> <span class=\"token string\">'/Users/Hsiang/tp/config/subModule.js'</span><span class=\"token punctuation\">,</span>\n      path<span class=\"token operator\">:</span> <span class=\"token string\">'/Users/Hsiang/tp/config'</span><span class=\"token punctuation\">,</span>\n      exports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>Object<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      parent<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>Circular<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      filename<span class=\"token operator\">:</span> <span class=\"token string\">'/Users/Hsiang/tp/config/subModule.js'</span><span class=\"token punctuation\">,</span>\n      loaded<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      paths<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>Array<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  paths<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">// 当前模块寻址Path顺序</span>\n    <span class=\"token string\">'/Users/Hsiang/tp/config/node_modules'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'/Users/Hsiang/tp/node_modules'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'/Users/Hsiang/node_modules'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'/Users/node_modules'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'/node_modules'</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"2-我们知道node导出模块有两种方式，一种是-exportsxxxxxx-和moduleexports-有什么区别吗\" style=\"position:relative;\"><a href=\"#2-%E6%88%91%E4%BB%AC%E7%9F%A5%E9%81%93node%E5%AF%BC%E5%87%BA%E6%A8%A1%E5%9D%97%E6%9C%89%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%8C%E4%B8%80%E7%A7%8D%E6%98%AF-exportsxxxxxx-%E5%92%8Cmoduleexports-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%E5%90%97\" aria-label=\"2 我们知道node导出模块有两种方式，一种是 exportsxxxxxx 和moduleexports 有什么区别吗 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 我们知道node导出模块有两种方式，一种是 exports.xxx=xxx 和module.exports={} 有什么区别吗</h3>\n<p><code class=\"language-text\">exports</code> 其实就是 <code class=\"language-text\">module.exports</code> 的引用，最终使用模块认的是 <code class=\"language-text\">module.exports</code> ，而不是 <code class=\"language-text\">exports</code>；保险起见，直接使用 <code class=\"language-text\">module.exports</code>。</p>\n<h3 id=\"3-加载模块时，为什么每个模块都有exports-require-module-__filename-__dirname属性呢？\" style=\"position:relative;\"><a href=\"#3-%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97%E6%97%B6%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%AF%8F%E4%B8%AA%E6%A8%A1%E5%9D%97%E9%83%BD%E6%9C%89exports-require-module-__filename-__dirname%E5%B1%9E%E6%80%A7%E5%91%A2%EF%BC%9F\" aria-label=\"3 加载模块时，为什么每个模块都有exports require module __filename __dirname属性呢？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 加载模块时，为什么每个模块都有exports, require, module, __filename, __dirname属性呢？</h3>\n<p>在执行模块代码之前，Node.js 会使用一个如下的函数封装器将其封装，模块内部的变量为<strong>函数及作用域</strong>：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// /Users/Hsiang/tp/config/module.js</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">exports<span class=\"token punctuation\">,</span> require<span class=\"token punctuation\">,</span> module<span class=\"token punctuation\">,</span> __filename<span class=\"token punctuation\">,</span> __dirname</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 模块的代码实际上在这里</span>\n  <span class=\"token comment\">// __filename === /Users/xx/projectName/src/module.js   绝对路径</span>\n  <span class=\"token comment\">// __dirname === /Users/xx/projectName/src   绝对路径</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"4-请介绍一下require的模块加载机制及模块寻找顺序？\" style=\"position:relative;\"><a href=\"#4-%E8%AF%B7%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8Brequire%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E5%8F%8A%E6%A8%A1%E5%9D%97%E5%AF%BB%E6%89%BE%E9%A1%BA%E5%BA%8F%EF%BC%9F\" aria-label=\"4 请介绍一下require的模块加载机制及模块寻找顺序？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 请介绍一下require的模块加载机制及模块寻找顺序？</h3>\n<p>require的接口定义如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">NodeRequire</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">NodeRequireFunction</span> <span class=\"token punctuation\">{</span>\n    resolve<span class=\"token operator\">:</span> RequireResolve<span class=\"token punctuation\">;</span>\n    cache<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span>\n    extensions<span class=\"token operator\">:</span> NodeExtensions<span class=\"token punctuation\">;</span>\n    main<span class=\"token operator\">:</span> NodeModule <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>require具体代码执行过程：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// require 其实内部调用 Module._load 方法</span>\nModule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">_load</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> parent<span class=\"token punctuation\">,</span> isMain</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//  计算绝对路径</span>\n  <span class=\"token keyword\">var</span> filename <span class=\"token operator\">=</span> Module<span class=\"token punctuation\">.</span><span class=\"token function\">_resolveFilename</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> parent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">//  第一步：如果有缓存，取出缓存</span>\n  <span class=\"token keyword\">var</span> cachedModule <span class=\"token operator\">=</span> Module<span class=\"token punctuation\">.</span>_cache<span class=\"token punctuation\">[</span>filename<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cachedModule<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> cachedModule<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 第二步：是否为内置模块</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>NativeModule<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> NativeModule<span class=\"token punctuation\">.</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token comment\">/********************************这里注意了**************************/</span>\n  <span class=\"token comment\">// 第三步：生成模块实例，存入缓存</span>\n  <span class=\"token comment\">// 这里的Module就是我们上面的1定义的Module</span>\n  <span class=\"token keyword\">var</span> module <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Module</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> parent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Module<span class=\"token punctuation\">.</span>_cache<span class=\"token punctuation\">[</span>filename<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> module<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/********************************这里注意了**************************/</span>\n  <span class=\"token comment\">// 第四步：加载模块</span>\n  <span class=\"token comment\">// 下面的module.load实际上是Module原型上有一个方法叫Module.prototype.load</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    module<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    hadException <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hadException<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">delete</span> Module<span class=\"token punctuation\">.</span>_cache<span class=\"token punctuation\">[</span>filename<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 第五步：输出模块的exports属性</span>\n  <span class=\"token keyword\">return</span> module<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>module.load 这里的寻址方式如下：</p>\n<ol>\n<li>如果是Core模块</li>\n<li>\n<p>如果是路径</p>\n<ol>\n<li>LOAD<em>AS</em>FILE: x.js -> x.json -> x.node</li>\n<li>LOAD<em>AS</em>DIRECTORY: </li>\n<li>\n<p>如果存在 package.json | main </p>\n<ol>\n<li>构造新位置M -> LOAD<em>AS</em>FILE(M) -> LOAD_INDEX(M)</li>\n</ol>\n</li>\n<li>LOAD_INDEX(M): index.js -> index.json -> index.node</li>\n</ol>\n</li>\n<li>其他…</li>\n</ol>\n<h3 id=\"5-如何判断当前js文件是被引用还是被直接运行？\" style=\"position:relative;\"><a href=\"#5-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E5%BD%93%E5%89%8Djs%E6%96%87%E4%BB%B6%E6%98%AF%E8%A2%AB%E5%BC%95%E7%94%A8%E8%BF%98%E6%98%AF%E8%A2%AB%E7%9B%B4%E6%8E%A5%E8%BF%90%E8%A1%8C%EF%BC%9F\" aria-label=\"5 如何判断当前js文件是被引用还是被直接运行？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 如何判断当前JS文件是被引用还是被直接运行？</h3>\n<p><code class=\"language-text\">require.main</code> 返回的是 <code class=\"language-text\">Module</code> 对象，表示当 Node.js 进程启动时加载的入口脚本。因此可以通过下面方式判定：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>require<span class=\"token punctuation\">.</span>main <span class=\"token operator\">===</span> module<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 当前文件为node主入口</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 当前文件为子模块</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"6-循环require模块会发生什么结果？\" style=\"position:relative;\"><a href=\"#6-%E5%BE%AA%E7%8E%AFrequire%E6%A8%A1%E5%9D%97%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BB%80%E4%B9%88%E7%BB%93%E6%9E%9C%EF%BC%9F\" aria-label=\"6 循环require模块会发生什么结果？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 循环require模块会发生什么结果？</h3>\n<blockquote>\n<p>摘抄自Node文档：<a href=\"http://nodejs.cn/api/modules.html\" target=\"_target\" rel=\"nofollow\">http://nodejs.cn/api/modules.html</a></p>\n</blockquote>\n<p>当循环调用 <code class=\"language-text\">require()</code> 时，一个模块可能在未完成执行时被返回。</p>\n<p>例如以下情况:</p>\n<p><code class=\"language-text\">a.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a 开始'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nexports<span class=\"token punctuation\">.</span>done <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> b <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./b.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'在 a 中，b.done = %j'</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nexports<span class=\"token punctuation\">.</span>done <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a 结束'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">b.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'b 开始'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nexports<span class=\"token punctuation\">.</span>done <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> a <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./a.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'在 b 中，a.done = %j'</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nexports<span class=\"token punctuation\">.</span>done <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'b 结束'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">main.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'main 开始'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> a <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./a.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> b <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./b.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'在 main 中，a.done=%j，b.done=%j'</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>当 <code class=\"language-text\">main.js</code> 加载 <code class=\"language-text\">a.js</code> 时， <code class=\"language-text\">a.js</code> 又加载 <code class=\"language-text\">b.js</code>。 此时， <code class=\"language-text\">b.js</code> 会尝试去加载 <code class=\"language-text\">a.js</code>。 为了防止无限的循环，会返回一个 <code class=\"language-text\">a.js</code> 的 <code class=\"language-text\">exports</code> 对象的 <strong><mark>未完成的副本（不是一定是空对象）</mark></strong> 给 <code class=\"language-text\">b.js</code> 模块。 然后 <code class=\"language-text\">b.js</code> 完成加载，并将 <code class=\"language-text\">exports</code> 对象提供给 <code class=\"language-text\">a.js</code> 模块。</p>\n<p>当 <code class=\"language-text\">main.js</code> 加载这两个模块时，它们都已经完成加载。 因此，该程序的输出会是：</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ node main.js\nmain 开始\na 开始\nb 开始\n在 b 中，a.done = false\nb 结束\n在 a 中，b.done = true\na 结束\n在 main 中，a.done=true，b.done=true</code></pre></div>\n<p>需要仔细的规划, 以允许循环模块依赖在应用程序内正常工作.</p>\n<h3 id=\"7-模块缓存，如何解除缓存问题？\" style=\"position:relative;\"><a href=\"#7-%E6%A8%A1%E5%9D%97%E7%BC%93%E5%AD%98%EF%BC%8C%E5%A6%82%E4%BD%95%E8%A7%A3%E9%99%A4%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98%EF%BC%9F\" aria-label=\"7 模块缓存，如何解除缓存问题？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. 模块缓存，如何解除缓存问题？</h3>\n<p>问题4中，关于require的工作机制提到了load模块时会存在缓存设计，即被引入的模块将被缓存在 <code class=\"language-text\">require.cache</code>  （等同于 <code class=\"language-text\">Module._cache</code> ）中；另外Module类在初始化时，会在 <code class=\"language-text\">parent.children</code> 中保存子模块的一个引用。根据Nodejs内存回收机制，简单的讲就是当一个对象没有被任何其他对象引用的时候（引用计数模式），这个对象就会被标记为可回收，并在下一次GC处理的时候释放内存。</p>\n<p>所以消除模块缓存需要做的处理如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">cleanCache</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">modulePath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> module <span class=\"token operator\">=</span> require<span class=\"token punctuation\">.</span>cache<span class=\"token punctuation\">[</span>modulePath<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> \n    <span class=\"token comment\">// 1. remove reference in module.parent</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        module<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">.</span><span class=\"token function\">splice</span><span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 2. 去除本身cache的引用（require.cache === module._cache）</span>\n    require<span class=\"token punctuation\">.</span>cache<span class=\"token punctuation\">[</span>modulePath<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"8-如何找到模块的绝对路径？\" style=\"position:relative;\"><a href=\"#8-%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0%E6%A8%A1%E5%9D%97%E7%9A%84%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%EF%BC%9F\" aria-label=\"8 如何找到模块的绝对路径？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. 如何找到模块的绝对路径？</h3>\n<p><strong>API: require.resolve(‘./moduleName’)</strong></p>\n<p>使用内部的 <code class=\"language-text\">require()</code> 机制查询模块的位置，此操作只返回解析后的文件名，不会加载该模块。</p>\n<p>如果找不到模块，则会抛出 <code class=\"language-text\">MODULE_NOT_FOUND</code> 错误。</p>\n<h3 id=\"9-mjs解释下\" style=\"position:relative;\"><a href=\"#9-mjs%E8%A7%A3%E9%87%8A%E4%B8%8B\" aria-label=\"9 mjs解释下 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9. mjs解释下</h3>\n<p> <code class=\"language-text\">.mjs</code> 扩展名是保留给 <a href=\"http://nodejs.cn/s/iyYkEg\" target=\"_target\" rel=\"nofollow\">ECMAScript 模块</a>，无法通过 <code class=\"language-text\">require()</code> 加载。目前处于实现性质阶段，不建议 <code class=\"language-text\">import</code> 和 <code class=\"language-text\">require</code> 混用；</p>","timeToRead":8,"wordCount":{"paragraphs":41,"sentences":42,"words":150},"fields":{"slug":"/nodejs-cha-lou-bu-que-mo-kuai-xiang-guan/","relativePath":"2020/2020-08-16---nodejs-cha-lou-bu-que-mo-kuai-xiang-guan/index.md"},"excerpt":"1 请介绍一下node里的模块是什么？ Node中，每个文件模块都是一个对象，它的接口  定义如下： 所有的模块都是 Module 的实例。module.exports…","frontmatter":{"title":"Nodejs查漏补缺-模块相关","date":"16 Aug 2020","tags":["Node"],"cover":"","comments":true,"author":"烈风裘"}}},"pageContext":{"curr":"/design-patterns-strategy-patterns/","prev":"/nodejs-cha-lou-bu-que-mo-kuai-xiang-guan/","next":"/cnpm-shi-yong-zong-jie/"}},"staticQueryHashes":["3240721340","63159454"]}