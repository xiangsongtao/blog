{"componentChunkName":"component---src-templates-blog-post-js","path":"/JavaScriptarguments-dui-xiang-quan/","result":{"data":{"site":{"siteMetadata":{"title":"Attila","cover":"/background/1.jpg","description":"Thoughts, stories and ideas.","keywords":["烈风裘的博客","X-Blog","Attila","Gatsby","前端成长记录"],"tagCover":"/background/5.jpg","archiveCover":"/background/escape-flight.png","siteUrl":"https://xiangst0816.github.io/blog","logo":"","navigation":true,"subscribe":true}},"allAuthorJson":{"totalCount":2,"edges":[{"node":{"id":"烈风裘","bio":"一往无前, 直到云开雾散!","avatar":"/avatar/me.jpeg","cover":"/background/photo-1503197979108-c824168d51a8.jpeg","github":"https://github.com/xiangst0816","twitter":"","zhihu":"","weibo":"","facebook":"","website":"https://xiangst0816.github.io/blog/","location":"HangZhou, China"}},{"node":{"id":"WALL-E","bio":"还有要清理的吗?","avatar":"/avatar/cleaner.jpg","cover":"","github":null,"twitter":null,"zhihu":null,"weibo":null,"facebook":null,"website":null,"location":"Earth"}}]},"master":{"id":"烈风裘","bio":"一往无前, 直到云开雾散!","avatar":"/avatar/me.jpeg","cover":"/background/photo-1503197979108-c824168d51a8.jpeg","github":"https://github.com/xiangst0816","twitter":"","zhihu":"","weibo":"","facebook":"","website":"https://xiangst0816.github.io/blog/","location":"HangZhou, China"},"currentPost":{"html":"<h2 id=\"什么是-arguments\" style=\"position:relative;\"><a href=\"#%E4%BB%80%E4%B9%88%E6%98%AF-arguments\" aria-label=\"什么是 arguments permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>什么是 arguments</h2>\n<p>arguments 是一个类数组的对象，代表传给一个 function 的参数列表。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function printArgs() {\n    console.log(arguments);\n}\n\nprintArgs(&quot;A&quot;, &quot;a&quot;, 0, { foo: &quot;Hello, arguments&quot; })；\n执行结果是：\n[&quot;A&quot;, &quot;a&quot;, 0, Object]</code></pre></div>\n<h2 id=\"arguments-操作\" style=\"position:relative;\"><a href=\"#arguments-%E6%93%8D%E4%BD%9C\" aria-label=\"arguments 操作 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>arguments 操作</h2>\n<h3 id=\"arguments-length\" style=\"position:relative;\"><a href=\"#arguments-length\" aria-label=\"arguments length permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>arguments length</h3>\n<p>arguments 是个类数组对象，其包含一个 length 属性，可以用 arguments.length 来获得传入函数的参数个数。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function func() {\n    console.log(&quot;The number of parameters is &quot; + arguments.length);\n}</code></pre></div>\n<h3 id=\"arguments-转数组\" style=\"position:relative;\"><a href=\"#arguments-%E8%BD%AC%E6%95%B0%E7%BB%84\" aria-label=\"arguments 转数组 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>arguments 转数组</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Array.prototype.slice.call(arguments);\n[].slice.call(arguments);</code></pre></div>\n<h3 id=\"arguments-传递出去\" style=\"position:relative;\"><a href=\"#arguments-%E4%BC%A0%E9%80%92%E5%87%BA%E5%8E%BB\" aria-label=\"arguments 传递出去 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>arguments 传递出去</h3>\n<p>将函数的 arguments 对象泄露出去了，最终的结果就是 V8 引擎将会跳过优化，导致相当大的性能损失。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// Leaking arguments example1:\nfunction getArgs() {\n    return arguments;\n}\n// good arguments example1:\nfunction getArgs() {\n    const args = [].slice.call(arguments);//slice返回新数组\n    return args;\n}</code></pre></div>\n<h3 id=\"修改-arguments-值\" style=\"position:relative;\"><a href=\"#%E4%BF%AE%E6%94%B9-arguments-%E5%80%BC\" aria-label=\"修改 arguments 值 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>修改 arguments 值</h3>\n<p>在严格模式与非严格模式下，修改函数参数值表现的结果不一样。在严格模式下，函数中的参数与 arguments 对象没有联系，修改一个值不会改变另一个值。而在非严格模式下，两个会同步影响。</p>\n<h3 id=\"将参数从一个函数传递到另一个函数\" style=\"position:relative;\"><a href=\"#%E5%B0%86%E5%8F%82%E6%95%B0%E4%BB%8E%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0%E4%BC%A0%E9%80%92%E5%88%B0%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0\" aria-label=\"将参数从一个函数传递到另一个函数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>将参数从一个函数传递到另一个函数</h3>\n<p>下面是将参数从一个函数传递到另一个函数的推荐做法。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function foo() {\n    bar.apply(this, arguments);\n}\nfunction bar(a, b, c) {\n    // logic\n}</code></pre></div>\n<h3 id=\"arguments-与重载\" style=\"position:relative;\"><a href=\"#arguments-%E4%B8%8E%E9%87%8D%E8%BD%BD\" aria-label=\"arguments 与重载 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>arguments 与重载</h3>\n<p>利用 arguments 模拟重载。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function add(num1, num2, num3) {\n    if (arguments.length === 2) {\n        console.log(&quot;Result is &quot; + (num1 + num2));\n    }\n    else if (arguments.length === 3) {\n        console.log(&quot;Result is &quot; + (num1 + num2 + num3));\n    }\n}</code></pre></div>\n<h2 id=\"es6-中的-arguments\" style=\"position:relative;\"><a href=\"#es6-%E4%B8%AD%E7%9A%84-arguments\" aria-label=\"es6 中的 arguments permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ES6 中的 arguments</h2>\n<h3 id=\"扩展操作符\" style=\"position:relative;\"><a href=\"#%E6%89%A9%E5%B1%95%E6%93%8D%E4%BD%9C%E7%AC%A6\" aria-label=\"扩展操作符 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>扩展操作符</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function func() {\n    console.log(...arguments);\n}\n\nfunc(1, 2, 3);\n执行结果是：\n1 2 3</code></pre></div>\n<h3 id=\"rest-参数\" style=\"position:relative;\"><a href=\"#rest-%E5%8F%82%E6%95%B0\" aria-label=\"rest 参数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rest 参数</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function func(firstArg, ...restArgs) {\n    console.log(Array.isArray(restArgs));\n    console.log(firstArg, restArgs);\n}\n\nfunc(1, 2, 3);\n执行结果是：\ntrue\n1 [2, 3]</code></pre></div>\n<p>从上面的结果可以看出，Rest 参数表示除了明确指定剩下的参数集合，类型是 Array。</p>\n<h3 id=\"默认参数\" style=\"position:relative;\"><a href=\"#%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0\" aria-label=\"默认参数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>默认参数</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function func(firstArg = 0, secondArg = 1) {\n    console.log(arguments[0], arguments[1]);\n    console.log(firstArg, secondArg);\n}\n\nfunc(99);\n执行结果是：\n99 undefined\n99 1</code></pre></div>\n<p>可见，默认参数对 arguments 没有影响，arguments 还是仅仅表示调用函数时所传入的所有参数。</p>\n<h3 id=\"arguments-转数组-1\" style=\"position:relative;\"><a href=\"#arguments-%E8%BD%AC%E6%95%B0%E7%BB%84-1\" aria-label=\"arguments 转数组 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>arguments 转数组</h3>\n<p>Array.from() 是个非常推荐的方法，其可以将所有类数组对象转换成数组。</p>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://segmentfault.com/a/1190000007091243\" target=\"_target\" rel=\"nofollow\">JavaScript arguments 对象全面介绍</a></li>\n</ul>","timeToRead":3,"wordCount":{"paragraphs":24,"sentences":24,"words":76},"fields":{"slug":"/JavaScriptarguments-dui-xiang-quan/","relativePath":"2016/2016-10-22---JavaScriptarguments-dui-xiang-quan/index.md"},"excerpt":"什么是 arguments arguments 是一个类数组的对象，代表传给一个 function 的参数列表。 arguments 操作 arguments length arguments…","frontmatter":{"title":"JavaScript arguments 对象全面介绍","date":"22 Oct 2016","tags":["JavaScript"],"cover":"","comments":true,"author":"烈风裘"}},"nextPost":{"html":"<p>浏览器缓存机制一般分为两种：HTML Meta 标签控制缓存和 <strong>HTTP 头信息</strong>。</p>\n<h2 id=\"html-meta-标签控制缓存\" style=\"position:relative;\"><a href=\"#html-meta-%E6%A0%87%E7%AD%BE%E6%8E%A7%E5%88%B6%E7%BC%93%E5%AD%98\" aria-label=\"html meta 标签控制缓存 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HTML Meta 标签控制缓存</h2>\n<p>非 HTTP 协议定义的缓存机制，如使用 HTML Meta 标签，Web 开发者可以在 HTML 页面的<head>节点中加入<meta>标签，代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">＜meta http-equiv=\"参数\" content=\"参数变量值\"＞</code></pre></div>\n<p><strong>参数可以是以下值：</strong></p>\n<p>expires(期限) 、Pragma(cache 模式)、Refresh(刷新) 、\nSet-Cookie(cookie 设定) 、Window-target(显示窗口的设定) 、\ncontent-Type(显示字符集的设定) 、Pics-label(网页等级评定) 、\ncache-control 等。</p>\n<p><a href=\"http://kinglyhum.iteye.com/blog/827807\" target=\"_target\" rel=\"nofollow\">设置请参考这里</a></p>\n<p>但是，所有缓存代理服务器都不支持上述方法，因为代理不解析 HTML 内容本身。而广泛应用的还是 <strong>HTTP 头信息</strong> 来控制缓存，下面主要介绍 HTTP 协议定义的缓存机制，这个是比较通用的做法。记住相应的参数、作用及设置方法，就差不多了。</p>\n<h2 id=\"http-头信息控制缓存\" style=\"position:relative;\"><a href=\"#http-%E5%A4%B4%E4%BF%A1%E6%81%AF%E6%8E%A7%E5%88%B6%E7%BC%93%E5%AD%98\" aria-label=\"http 头信息控制缓存 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HTTP 头信息控制缓存</h2>\n<h3 id=\"资源新鲜度检测（freshness）\" style=\"position:relative;\"><a href=\"#%E8%B5%84%E6%BA%90%E6%96%B0%E9%B2%9C%E5%BA%A6%E6%A3%80%E6%B5%8B%EF%BC%88freshness%EF%BC%89\" aria-label=\"资源新鲜度检测（freshness） permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>资源新鲜度检测（Freshness）</h3>\n<p><code class=\"language-text\">Cache Control</code>与<code class=\"language-text\">Expires</code>是一组，他们是用来进行 Freshness 验证，也就是提供客户端检测文件是否足够新鲜，可以无需向服务端发起 Validation 请求(见下)就能保证并未过期可以直接使用。</p>\n<p>所有的<code class=\"language-text\">(from cache)</code>的请求实际上都是由于浏览器认为本地的缓存资源足够新鲜，所以无需额外请求而直接使用。实际上就是根据本地的时间和服务器返回头的约定信息进行对比验证。</p>\n<h4 id=\"expires\" style=\"position:relative;\"><a href=\"#expires\" aria-label=\"expires permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Expires</h4>\n<p>在 HTTP1.0 版本中定义的是<code class=\"language-text\">Expires</code>，<code class=\"language-text\">Expires</code>的值是一个明确的<strong>GMT 格式</strong>的过期时间，指浏览器或缓存服务器在该时间点后必须从真正的服务器中获取新的页面信息；<mark>当用户的时间和服务器时间不一致的手，会引发缓存判断的问题</mark>（例如客户端的本地时间错误）。如果不设置缓存，需要将<code class=\"language-text\">Expires</code>设为 0；</p>\n<h4 id=\"cache-control\" style=\"position:relative;\"><a href=\"#cache-control\" aria-label=\"cache control permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache Control</h4>\n<p>因此，在 HTTP1.1 版本中再追加判断字段：<code class=\"language-text\">Cache-Control</code>。<strong>其中<code class=\"language-text\">max-age</code>参数告知客户端这个文件多长时间不会过期</strong>而不是直接告知过期时间。常用的参数如下：</p>\n<ul>\n<li>no-cache：浏览器和缓存服务器都不应该缓存页面信息；</li>\n<li>private：只在内存中缓存, 默认；</li>\n<li>no-store：请求和响应的信息都不应该被存储在对方的磁盘系统中；</li>\n<li>must-revalidate：对于客户机的每次请求，代理服务器必须向服务器验证缓存是否过时；</li>\n<li>public, max-age=[number]：在硬盘中缓存, 浏览器和缓存服务器都可以缓存页面信息，并设定具体的过期秒数</li>\n</ul>\n<blockquote>\n<p>以上两个如果同时存在，则<code class=\"language-text\">Cache Control</code>的<code class=\"language-text\">max-age</code>将覆盖<code class=\"language-text\">Expires</code>.</p>\n</blockquote>\n<h3 id=\"资源验证（validation）\" style=\"position:relative;\"><a href=\"#%E8%B5%84%E6%BA%90%E9%AA%8C%E8%AF%81%EF%BC%88validation%EF%BC%89\" aria-label=\"资源验证（validation） permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>资源验证（Validation）</h3>\n<p><code class=\"language-text\">Last-Modified</code>和<code class=\"language-text\">ETag</code>则是另一组控制信息，他们用来实现 Validation。他们的职责是在本地缓存被浏览器判断可能不够新鲜的时候，会用这两组信息向服务器请求数据，如果服务器内容没有改变，那么约定服务器会返回 <strong>304(Not Modify)</strong> HTTP Code 表明这个缓存可以直接使用，无需重新拉取，而一旦服务器内容改变了就会返回 <strong>200(from cache)</strong>，同时返回新的文件内容。</p>\n<h4 id=\"last-modified\" style=\"position:relative;\"><a href=\"#last-modified\" aria-label=\"last modified permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Last-Modified</h4>\n<p>在 HTTP 1.0 中约定的<code class=\"language-text\">Last-Modified</code>代表的含义是文件最后一次修改的<strong>GMT 格式</strong>的时间，但是当访问的静态资源师动态生成的，<strong>比如动态 gzip 压缩 js/css 代码，那么返回的<code class=\"language-text\">Last-Modified</code>每次都会不一样</strong>；另外<code class=\"language-text\">Last-Modified</code>只能精确到秒，如果文件变动在秒以内，则客户端无法感知。</p>\n<p>如果用户第二次打开，在请求头上会添加<code class=\"language-text\">If-Modified-Since</code>关键字，传递本地缓存的资源最后修改时间<code class=\"language-text\">Last-Modified</code>，之后由服务器判断是返回 304 NotModified 还是 200 OK(新资源)</p>\n<h4 id=\"etag\" style=\"position:relative;\"><a href=\"#etag\" aria-label=\"etag permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ETag</h4>\n<p>因此，在 HTTP1.1 版本中再追加判断字段：<code class=\"language-text\">ETag</code>。他的实现不尽相同，对于<strong>动态内容</strong>，常规做法是对动态内容做 HASH 计算，作为 ETAG 返回，对于静态资源，一般是使用 inode+mtime 进行计算。</p>\n<p>同样，如果之前设置了此值，当用户第二次打开时，请求头会携带<code class=\"language-text\">If-None-Match</code>关键字，判断资源的<code class=\"language-text\">ETag</code>是否过期。</p>\n<p>ETag 也有他自己的问题，所以经常在使用中会关闭<code class=\"language-text\">ETag</code>。举例来说，同一个文件在不同物理机上的 inode 是不同的，这就导致了在分布式的 Web 系统中，当访问落在不同的物理机上时会返回不同的<code class=\"language-text\">ETag</code>，进而导致 304 失效，降级为 200 请求。解决办法也有从<code class=\"language-text\">ETag</code>算法中剥离 inode，只是使用 mtime，但是这样实际上和<code class=\"language-text\">Last-Modified</code>就一样了。当然你也可以额外的做一些改进，使<code class=\"language-text\">ETag</code>对静态资源的算法也是通过 hash 计算的。不过由于一般我们会使用 CDN 技术，因此集群部署中的<code class=\"language-text\">ETag</code>问题并不会造成太大的影响，所以折腾的人也不太是很多。</p>\n<h3 id=\"nodejs--express-处理方式\" style=\"position:relative;\"><a href=\"#nodejs--express-%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F\" aria-label=\"nodejs  express 处理方式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nodejs + Express 处理方式</h3>\n<h4 id=\"静态资源处理\" style=\"position:relative;\"><a href=\"#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86\" aria-label=\"静态资源处理 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>静态资源处理</h4>\n<ul>\n<li>设置 30 天后过期</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n  express<span class=\"token punctuation\">.</span><span class=\"token function\">static</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    etag<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//资源标记</span>\n    maxAge<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//除去下面格式的其余文件不缓存，比如html</span>\n    <span class=\"token function-variable function\">setHeaders</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token regex\">/\\.(js|css|png|gif|jpg|jpeg)$/</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 未来的一个过期时间</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Expires\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">2592000</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toGMTString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cache-Control\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"public, max-age=2592000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>不缓存</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">static</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'public'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    etag<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//资源标记</span>\n    maxAge<span class=\"token operator\">:</span> <span class=\"token number\">0</span>，\n    <span class=\"token function-variable function\">setHeaders</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\.(js|css|png|gif|jpg|jpeg)$/</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            res<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Expires'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            res<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Cache-Control'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'no-cache'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"缓存策略根据不同的重新浏览方式分为以下几种情况\" style=\"position:relative;\"><a href=\"#%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E7%9A%84%E9%87%8D%E6%96%B0%E6%B5%8F%E8%A7%88%E6%96%B9%E5%BC%8F%E5%88%86%E4%B8%BA%E4%BB%A5%E4%B8%8B%E5%87%A0%E7%A7%8D%E6%83%85%E5%86%B5\" aria-label=\"缓存策略根据不同的重新浏览方式分为以下几种情况 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>缓存策略根据不同的重新浏览方式分为以下几种情况</h3>\n<ul>\n<li>\n<p>打开新窗口</p>\n<p>如果指定 cache-control 的值为 private、no-cache、must-revalidate，那么打开新窗口访问时都会重新访问服务器。而如果指定了 max-age 值，那么在此值内的时间里就不会重新访问服务器，例如：</p>\n<p>Cache-control: max-age=5\n表示当访问此网页后的 5 秒内再次访问不会去服务器获取资源</p>\n</li>\n<li>\n<p>在地址栏回车</p>\n<p>如果值为 private 或 must-revalidate（和网上说的不一样），则只有第一次访问时会访问服务器，以后就不再访问。如果值为 no-cache，那么每次都会访问。如果值为 max-age，则在过期之前不会重复访问。</p>\n</li>\n<li>\n<p>按后退按扭</p>\n<p>如果值为 private、must-revalidate、max-age，则不会重新访问，而如果为 no-cache，则每次都重复访问</p>\n</li>\n<li>\n<p>按刷新按扭</p>\n<p>无论为何值，都会重复访问</p>\n</li>\n</ul>\n<h3 id=\"总结一下\" style=\"position:relative;\"><a href=\"#%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B\" aria-label=\"总结一下 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>总结一下</h3>\n<p><code class=\"language-text\">ETag</code>的设置并不会影响 Freshness 验证，Freshness 验证只会和浏览器策略、<code class=\"language-text\">Cache Control</code>、<code class=\"language-text\">Expires</code>有关。</p>\n<p>也就是说，如果访问的静态资源并不会存在小于 1s 的求改情况，<code class=\"language-text\">ETag</code>可以关闭。</p>\n<p>下面是上述文字的整个流程图：</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 472px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 109.52380952380953%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAAD4ElEQVQ4y42UW0hcVxSGz5lMICmhD32SUtMWkjSJJKJGaaQ3ShvoY9K3ICUPfShSYsDSBxMkfRQ1rTZtodAHcR7qeEcU8X7HGypateL9ftcZdcYZz5zZ/dZhZhBJmWxY7H32Xus/61/r31sbHBzUZGRlZdnW19e/3t3dzVhaWkpfW1tL39vbe7KwsJAk56Zp6g0NDVrUQbBN5oqKirc3NjZ8igGw2t/fl6Wam5tzyjlLO+BWjNfr1V5rZGdnxzqdzsS8vLyUwsLCpKKiooS4uLg3TvtEBTs+Pr5MZp+3tLR83NbWltzf33+ruLj4s/r6+tSxsbHb0LyLfQLQR263+5LETE5O6jMzMzYytmxxcdE2Oztra29v1zTDMH4SakLx6OhIHRwcKPZUIBBQ/MzaB8ii7/P54qPS9Hg8WeJMsI91gDlweHhomXxjBmYCfOz3+1Nx1WFyaX5+PmV1dTV1ZWXlLjVP5fvDrq6uiwL4lA4qDv0jIyMm6Zs4BAEOQs2cmpoyAVIEujY3Nxeg2kRZsoXB1taWxSrMAN90AXwmHzs7OyYyUcjGcoKekm+hHKJuEHgf4Jjy8vL3Ghsbv29qaspobW19TP0zmpubHzscjliNv/8ogBTdhXkA8hK8QvC2rBlH/NQLqJvaXotaQ5fL9RaBNwH+gKAbYL9P1/+CTgbrWPZuAnSd+SplucCeRjZ6T0/PObG+vj7Lent77VVVVforf0Idny8vL9971RkN0QYGBnTqa5uYmLDm8fFxm+xHBlJ5hwySyDKeWt5C4In5+fkJZHYbyvHUNIHavim+6FP/P7bha6ydnJz8KnWkcz5pDhkqrmRQpMO2ETr7NBxIhjGcX8PvCk26QuevlpSUXIggk8lLCSJDY3t7W0FDoXyr42Qo5mddRRmm6ep3PBwoaNO689TVUgRnztOAVoZk6sfRFCPIBMTkLCA6pevfABBfVlZ2GZn80NnZ+RJ70dHR8aK7u/v3mpqar04D/hbOEJoKMEX3rWsYyjCAJh1k8ycPRjLnf7OeZB4SI4F/UcUfEUAyKwzdVS9ABrVxIx0PWRnsGZz72P8FWs8QddzQ0JADG+Vm9Q0PD/eOjo7+w/rnCCBdjEW8Kcx3CEykjt/y1wcAJgCWRIbJ2usOEerZQedKsLSz+9A7X11drcsDIXFnTLfb7RFQneKe48WQDL+g2A+h9AAJfTk9Pf2u+NAgS3/UTisoKNBKS0s1pKLxIFtzTk5ORFOWY2VlZQw0T4LBoJLGyAMhA4DS0E9ttbW10Snn5uaGlzoFv0fQo7q6ujRuRBrzI16QG3KINLTMzMyoeP8B6PjYxiD3rI0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"流程图\"\n        title=\"流程图\"\n        src=\"/blog/static/b65e46de39a67256740c7fd77f31e2a2/49211/1476065346000.png\"\n        srcset=\"/blog/static/b65e46de39a67256740c7fd77f31e2a2/e1650/1476065346000.png 210w,\n/blog/static/b65e46de39a67256740c7fd77f31e2a2/8cae7/1476065346000.png 420w,\n/blog/static/b65e46de39a67256740c7fd77f31e2a2/49211/1476065346000.png 472w\"\n        sizes=\"(max-width: 472px) 100vw, 472px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">流程图</figcaption>\n  </figure></p>\n<p><strong>说明点:</strong></p>\n<ul>\n<li>当 freshness 检查失败，则发送资源请求并携带 ETage 和 Last-Modified 信息</li>\n<li>ETag 和 Last-Modified 都会发送给服务器不分前后</li>\n<li>Etag 用于动态内容会比 Last-Modified 好</li>\n</ul>\n<h3 id=\"参考文章\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0\" aria-label=\"参考文章 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考文章</h3>\n<ul>\n<li><a href=\"http://www.cnblogs.com/liuling/archive/2013/07/25/2013-7-25-01.html\" target=\"_target\" rel=\"nofollow\">页面的缓存与不缓存设置</a></li>\n<li><a href=\"http://div.io/topic/854#4091\" target=\"_target\" rel=\"nofollow\">配置错误产生的差距：200 OK (FROM CACHE) 与 304 NOT MODIFIED</a></li>\n<li><a href=\"http://www.cnblogs.com/cuixiping/archive/2008/05/04/1181056.html\" target=\"_target\" rel=\"nofollow\">“Cache-control”常见的取值</a></li>\n<li><a href=\"http://kinglyhum.iteye.com/blog/827807\" target=\"_target\" rel=\"nofollow\">Meta http-equiv 属性详解</a></li>\n<li><a href=\"https://my.oschina.net/leejun2005/blog/369148\" target=\"_target\" rel=\"nofollow\">浏览器 HTTP 协议缓存机制详解</a></li>\n</ul>","timeToRead":8,"wordCount":{"paragraphs":59,"sentences":59,"words":334},"fields":{"slug":"/ye-mian-huan-cun-she-zhi/","relativePath":"2016/2016-10-22---ye-mian-huan-cun-she-zhi/index.md"},"excerpt":"浏览器缓存机制一般分为两种：HTML Meta 标签控制缓存和 HTTP 头信息。 HTML Meta 标签控制缓存 非 HTTP 协议定义的缓存机制，如使用 HTML Meta 标签，Web 开发者可以在 HTML…","frontmatter":{"title":"页面缓存设置","date":"22 Oct 2016","tags":["缓存"],"cover":"","comments":true,"author":"烈风裘"}},"prevPost":{"html":"<h2 id=\"dom-事件流\" style=\"position:relative;\"><a href=\"#dom-%E4%BA%8B%E4%BB%B6%E6%B5%81\" aria-label=\"dom 事件流 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DOM 事件流</h2>\n<p>分为三个阶段：事件捕获阶段、目标阶段、事件冒泡阶段。</p>\n<p>事件捕获老版本浏览器（IE&#x3C;=8）不支持，但是事件冒泡可以放心使用。</p>\n<p><img src=\"http://xiangsongtao.com/uploads/1477529052000.jpeg\" alt=\"12\"></p>\n<h2 id=\"事件处理程序\" style=\"position:relative;\"><a href=\"#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F\" aria-label=\"事件处理程序 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>事件处理程序</h2>\n<blockquote>\n<p>一共四类写法，基本都见过，看下写法就知道怎么回事儿了。</p>\n</blockquote>\n<h3 id=\"1-html-事件处理程序\" style=\"position:relative;\"><a href=\"#1-html-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F\" aria-label=\"1 html 事件处理程序 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. HTML 事件处理程序</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;input type=&quot;button&quot; value=&quot;Click me&quot; onclick=&quot;ShowMessage()&quot;/&gt;</code></pre></div>\n<h3 id=\"2-dom0-级事件处理程序\" style=\"position:relative;\"><a href=\"#2-dom0-%E7%BA%A7%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F\" aria-label=\"2 dom0 级事件处理程序 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. DOM0 级事件处理程序</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var btn = document.getElementById(&quot;myBtn&quot;);\nbtn.onclick = function(){\n\talert(&quot;click!&quot;);\n\talert(this.id);//this指向myBtn，可继续获取myBtn的其余属性\n}</code></pre></div>\n<h3 id=\"3-dom2-级事件处理程序\" style=\"position:relative;\"><a href=\"#3-dom2-%E7%BA%A7%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F\" aria-label=\"3 dom2 级事件处理程序 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. DOM2 级事件处理程序</h3>\n<p>定义事件及删除事件的两个方法：addEventListener、removeEventListener。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var btn = document.getElementById(&quot;myBtn&quot;);\nbtn.addEventListener(&quot;click&quot;,function(){\n\talert(this.id);\n},false);</code></pre></div>\n<p>第三个参数：true，表示在捕获阶段触发；false，表示程序在冒泡阶段触发；</p>\n<p>removeEventListener()的第二个参数必须传入与 addEventListener()中相同的处理函数(传入相同的函数引用，而不是形同函数！)，否则不会生效。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var handler = function handler(){\n\talert(this.id);\n}\nbtn.addEventListener(&quot;click&quot;, handler, false);\nbtn.removeEventListener(&quot;click&quot;, handler, false);</code></pre></div>\n<h3 id=\"4-ie-事件处理函数\" style=\"position:relative;\"><a href=\"#4-ie-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0\" aria-label=\"4 ie 事件处理函数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. IE 事件处理函数</h3>\n<blockquote>\n<p>IE 就是这么另类（IE8 及更早版本）</p>\n</blockquote>\n<p>定义事件及删除事件的两个方法：attachEvent、detachEvent。因为只支持冒泡，故第三个参数没有；且第一个参数需要带上<strong>“on”</strong>！</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var handler = function handler(){\n\talert(this.id);\n}\nbtn.attachEvent(&quot;onclick&quot;, handler);\nbtn.detachEvent(&quot;onclick&quot;, handler);</code></pre></div>\n<h2 id=\"事件对象\" style=\"position:relative;\"><a href=\"#%E4%BA%8B%E4%BB%B6%E5%AF%B9%E8%B1%A1\" aria-label=\"事件对象 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>事件对象</h2>\n<p>事件触发会在 handler 中传入事件对象 event。</p>\n<h3 id=\"1-dom-中的事件对象\" style=\"position:relative;\"><a href=\"#1-dom-%E4%B8%AD%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%AF%B9%E8%B1%A1\" aria-label=\"1 dom 中的事件对象 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. DOM 中的事件对象</h3>\n<p>event 的成员属性及说明如下，以下属性皆为只读：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">属性/方法</th>\n<th align=\"center\">说明</th>\n<th align=\"center\">示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">bubble</td>\n<td align=\"center\">表示事件是否冒泡</td>\n<td align=\"center\">event.bubble -> true/false</td>\n</tr>\n<tr>\n<td align=\"center\">cancelable</td>\n<td align=\"center\">是否可以取消事件的默认行为</td>\n<td align=\"center\">event.cancelable -> true/false</td>\n</tr>\n<tr>\n<td align=\"center\">currentTarget</td>\n<td align=\"center\">事件函数正在处理事件的那个元素，比如委托 document 处理</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">defaultPrevented</td>\n<td align=\"center\">为 true 则表示已经调用了 preventDefault()</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">eventPhase</td>\n<td align=\"center\">事件处理阶段，1 捕获阶段，2 目标，3 冒泡阶段</td>\n<td align=\"center\">event.eventPhase === 1</td>\n</tr>\n<tr>\n<td align=\"center\">preventDefault()</td>\n<td align=\"center\">取消默认行为</td>\n<td align=\"center\">event. preventDefault();</td>\n</tr>\n<tr>\n<td align=\"center\">stopPropagation()</td>\n<td align=\"center\">取消进一步冒泡捕获行为</td>\n<td align=\"center\">event.stopPropagation();</td>\n</tr>\n<tr>\n<td align=\"center\">stopImmediatePropagation()</td>\n<td align=\"center\">取消进一步冒泡捕获行为,并阻止任何事件处理程序被调用</td>\n<td align=\"center\">event.stopImmediatePropagation();</td>\n</tr>\n<tr>\n<td align=\"center\">target</td>\n<td align=\"center\">设计目标</td>\n<td align=\"center\">event.target === getElementById(id)</td>\n</tr>\n<tr>\n<td align=\"center\">type</td>\n<td align=\"center\">触发事件的类型</td>\n<td align=\"center\">event.type === ‘click’</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"2-ie-中事件对象\" style=\"position:relative;\"><a href=\"#2-ie-%E4%B8%AD%E4%BA%8B%E4%BB%B6%E5%AF%B9%E8%B1%A1\" aria-label=\"2 ie 中事件对象 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. IE 中事件对象</h3>\n<p>因为 IE 中没有捕获，故简单了些。<strong>注意对比两个表的区别！</strong></p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">属性/方法</th>\n<th align=\"center\">说明</th>\n<th align=\"center\">示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">returnValue</td>\n<td align=\"center\">取消默认行为</td>\n<td align=\"center\">event. returnValue = false; //取消默认行为</td>\n</tr>\n<tr>\n<td align=\"center\">cancelBubble</td>\n<td align=\"center\">取消进一步冒泡捕获行为</td>\n<td align=\"center\">event.cancelBubble = true;//取消冒泡</td>\n</tr>\n<tr>\n<td align=\"center\">srcElement</td>\n<td align=\"center\">设计目标</td>\n<td align=\"center\">event.srcElement === getElementById(id)</td>\n</tr>\n<tr>\n<td align=\"center\">type</td>\n<td align=\"center\">触发事件的类型</td>\n<td align=\"center\">event.type === ‘click’</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"3-跨浏览器兼容方案\" style=\"position:relative;\"><a href=\"#3-%E8%B7%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%96%B9%E6%A1%88\" aria-label=\"3 跨浏览器兼容方案 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 跨浏览器兼容方案</h3>\n<p>为了保证大多数浏览器的兼容，故只需要考虑冒泡阶段的实现。上面说的很清楚了，这里直接上代码。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var EventUtil = {\n    // 绑定事件\n    addHandler: function addHandler(element, type, handler) {\n        if (element.addEventListener) {\n            element.addEventListener(type, handler, false);\n        } else if (element.attachEvent) {\n            element.attachEvent(&#39;on&#39; + type, handler);\n        } else {\n            element[&#39;on&#39; + type] = handler;\n        }\n    },\n    // 解绑事件\n    removeHandler: function removeHandler(element, type, handler) {\n        if (element.removeEventListener) {\n            element.removeEventListener(type, handler, false);\n        } else if (element.detachEvent) {\n            element.detachEvent(&#39;on&#39; + type, handler);\n        } else {\n            element[&#39;on&#39; + type] = null;\n        }\n    },\n    // 获取事件对象event\n    getEvent: function getEvent(event) {\n        return event || window.event;\n    },\n    // 获取触发目标\n    getTarget: function getTarget(event) {\n        return event.target || event.srcElement;\n    },\n    // 阻止默认行为\n    preventDefault: function preventDefault(event) {\n        if (event.preventDefault) {\n            event.preventDefault()\n        } else {\n            event.returnValue = false;\n        }\n    },\n    // 取消冒泡\n    stopPropagation: function stopPropagation(event) {\n        if (event.stopPropagation) {\n            event.stopPropagation()\n        } else {\n            event.cancelBubble = true;\n        }\n    }\n}</code></pre></div>\n<h2 id=\"事件的代理委托的原理以及优缺点\" style=\"position:relative;\"><a href=\"#%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%BB%A3%E7%90%86%E5%A7%94%E6%89%98%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E4%BC%98%E7%BC%BA%E7%82%B9\" aria-label=\"事件的代理委托的原理以及优缺点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>事件的代理/委托的原理以及优缺点</h2>\n<p>这是靠事件的冒泡机制来实现的，优点是</p>\n<blockquote>\n<p>1、可以大量节省内存占用，减少事件注册，比如在 table 上代理所有 td 的 click 事件就非常棒\n2、可以实现当新增子对象时无需再次对其绑定事件，对于动态内容部分尤为合适</p>\n</blockquote>\n<h2 id=\"手写原生-js【实现事件代理】，并要求兼容浏览器\" style=\"position:relative;\"><a href=\"#%E6%89%8B%E5%86%99%E5%8E%9F%E7%94%9F-js%E3%80%90%E5%AE%9E%E7%8E%B0%E4%BA%8B%E4%BB%B6%E4%BB%A3%E7%90%86%E3%80%91%EF%BC%8C%E5%B9%B6%E8%A6%81%E6%B1%82%E5%85%BC%E5%AE%B9%E6%B5%8F%E8%A7%88%E5%99%A8\" aria-label=\"手写原生 js【实现事件代理】，并要求兼容浏览器 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>手写原生 js【实现事件代理】，并要求兼容浏览器</h2>\n<p>考核对事件对象 event 的了解程度，以及在 IE 下对应的属性名。其实此时如果你说就是用<code class=\"language-text\">target/currentTarget</code>，以及 IE 下的<code class=\"language-text\">srcElement/this</code>，基本就可以略过了</p>\n<p>绑到按钮上：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var btn = document.getElementById(&quot;myBtn&quot;);\nbtn.addEventListener(&quot;click&quot;,function(){\n\tconsole.log(event.currentTarget === this);//true\n\tconsole.log(event.target === this);//true\n},false);</code></pre></div>\n<p>绑到 document 上：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var btn = document.getElementById(&quot;myBtn&quot;);\ndocument.body.onclick = function(){\n\tconsole.log(event.currentTarget === this );//true\n\tconsole.log(document.body === this );//true\n\tconsole.log(event.target === btn);//true\n}</code></pre></div>\n<h2 id=\"实现事件模型\" style=\"position:relative;\"><a href=\"#%E5%AE%9E%E7%8E%B0%E4%BA%8B%E4%BB%B6%E6%A8%A1%E5%9E%8B\" aria-label=\"实现事件模型 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>实现事件模型</h2>\n<p>一个 bind 一个 trigger，分别实现绑定事件和触发事件，核心需求就是可以对某一个事件名称绑定多个事件响应函数，然后触发这个事件名称时，依次按绑定顺序触发相应的响应函数。</p>\n<p>大致实现思路就是创建一个类或是匿名函数，在 bind 和 trigger 函数外层作用域创建一个字典对象，用于存储注册的事件及响应函数列表，bind 时，如果字典没有则创建一个，key 是事件名称，value 是数组，里面放着当前注册的响应函数，如果字段中有，那么就直接 push 到数组即可。trigger 时调出来依次触发事件响应函数即可。</p>\n<h2 id=\"事件如何派发也就是事件广播（dispatchevent）\" style=\"position:relative;\"><a href=\"#%E4%BA%8B%E4%BB%B6%E5%A6%82%E4%BD%95%E6%B4%BE%E5%8F%91%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%BA%8B%E4%BB%B6%E5%B9%BF%E6%92%AD%EF%BC%88dispatchevent%EF%BC%89\" aria-label=\"事件如何派发也就是事件广播（dispatchevent） permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>事件如何派发也就是事件广播（dispatchEvent）</h2>\n<p>这个是自定义事件及事件触发的应用（createEvent/dispatchEvent, createEventObject/fireEvent）</p>\n<p>一般我们在元素上绑定事件后，是靠用户在这些元素上的鼠标行为来捕获或者触发事件的，或者自带的浏览器行为事件，比如 click，mouseover，load 等等，有些时候我们需要自定义事件或者在特定的情况下需要触发这些事件。这个时候我们可以使用 IE 下 fireEvent 方法，高级浏览器（chrome,firefox 等）有 dispatchEvent 方法。</p>\n<h2 id=\"小结\" style=\"position:relative;\"><a href=\"#%E5%B0%8F%E7%BB%93\" aria-label=\"小结 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>小结</h2>\n<ol>\n<li>有必要限制一个页面中事件处理程序的数量，因为太多会占用大量内存，导致卡顿</li>\n<li>建立在事件冒泡机制上的事件委托技术，可以有效减少事件的处理程序的数量</li>\n<li>建议再浏览器写在页面之前移除页面的所有事件处理程序</li>\n</ol>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"http://www.w3cmark.com/2016/439.html\" target=\"_target\" rel=\"nofollow\">事件模型及事件代理/委托</a></li>\n</ul>","timeToRead":8,"wordCount":{"paragraphs":42,"sentences":42,"words":183},"fields":{"slug":"/shi-jian-mo-mu-xing/","relativePath":"2016/2016-10-23---shi-jian-mo-mu-xing/index.md"},"excerpt":"DOM 事件流 分为三个阶段：事件捕获阶段、目标阶段、事件冒泡阶段。 事件捕获老版本浏览器（IE<=8）不支持，但是事件冒泡可以放心使用。 12 事件处理程序 一共四类写法，基本都见过，看下写法就知道怎么回事儿了。…","frontmatter":{"title":"事件模型","date":"23 Oct 2016","tags":["DOM"],"cover":"","comments":true,"author":"烈风裘"}}},"pageContext":{"curr":"/JavaScriptarguments-dui-xiang-quan/","prev":"/shi-jian-mo-mu-xing/","next":"/ye-mian-huan-cun-she-zhi/"}},"staticQueryHashes":["3240721340","63159454"]}