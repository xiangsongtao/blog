{"componentChunkName":"component---src-templates-blog-post-js","path":"/di-er-shi-san-zhang/","result":{"data":{"site":{"siteMetadata":{"title":"Attila","cover":"/background/1.jpg","description":"Thoughts, stories and ideas.","keywords":["烈风裘的博客","X-Blog","Attila","Gatsby","前端成长记录"],"tagCover":"/background/5.jpg","archiveCover":"/background/escape-flight.png","siteUrl":"https://xiangst0816.github.io/blog","logo":"","navigation":true,"subscribe":true}},"allAuthorJson":{"totalCount":2,"edges":[{"node":{"id":"烈风裘","bio":"一往无前, 直到云开雾散!","avatar":"/avatar/me.jpeg","cover":"/background/photo-1503197979108-c824168d51a8.jpeg","github":"https://github.com/xiangsongtao","twitter":"","zhihu":"","weibo":"","facebook":"","website":"https://xiangsongtao.github.io/blog/","location":"HangZhou, China"}},{"node":{"id":"WALL-E","bio":"还有要清理的吗?","avatar":"/avatar/cleaner.jpg","cover":"","github":null,"twitter":null,"zhihu":null,"weibo":null,"facebook":null,"website":null,"location":"Earth"}}]},"master":{"id":"烈风裘","bio":"一往无前, 直到云开雾散!","avatar":"/avatar/me.jpeg","cover":"/background/photo-1503197979108-c824168d51a8.jpeg","github":"https://github.com/xiangsongtao","twitter":"","zhihu":"","weibo":"","facebook":"","website":"https://xiangsongtao.github.io/blog/","location":"HangZhou, China"},"currentPost":{"html":"<h3 id=\"1-如何判断在线状态\" style=\"position:relative;\"><a href=\"#1-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E5%9C%A8%E7%BA%BF%E7%8A%B6%E6%80%81\" aria-label=\"1 如何判断在线状态 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 如何判断在线状态?</h3>\n<p><strong>属性:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">navigator<span class=\"token punctuation\">.</span>onLine<span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>事件:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">EventUtil<span class=\"token punctuation\">.</span><span class=\"token function\">addHandler</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">,</span> <span class=\"token string\">\"online\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Online\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nEventUtil<span class=\"token punctuation\">.</span><span class=\"token function\">addHandler</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">,</span> <span class=\"token string\">\"offline\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Offline\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"2-manifest-应用缓存\" style=\"position:relative;\"><a href=\"#2-manifest-%E5%BA%94%E7%94%A8%E7%BC%93%E5%AD%98\" aria-label=\"2 manifest 应用缓存 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. manifest 应用缓存</h3>\n<p>看下 Gatsby 的实现. 书上说的和 Gatsby 实现的方式不一样.</p>\n<ul>\n<li>gatsby-plugin-offline</li>\n<li>gatsby-plugin-manifest</li>\n</ul>\n<h3 id=\"3-cookie-相关\" style=\"position:relative;\"><a href=\"#3-cookie-%E7%9B%B8%E5%85%B3\" aria-label=\"3 cookie 相关 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Cookie 相关</h3>\n<p><strong>作用:</strong></p>\n<p>在客户端用于存储会话信息的</p>\n<p><strong>限制:</strong></p>\n<ul>\n<li>一个域下的所有 cookie 长度限制在 4095B(含)以内</li>\n<li>每个域名下 cookie 个数不超过 50 个(一般最大)</li>\n<li>每次请求会携带 cookie, 不建议存储大信息量</li>\n<li>cookie 不会区分大小写, 内部”名称”, “值”都是经过 URL 编码的</li>\n</ul>\n<p><strong>组成:</strong></p>\n<p>名称, 值, 域, 路径, 失效时间, 安全标志</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">name=value; expires=Mon, 22-Jan-07 07:10:24 GMT; domain=.wrox.com\nname=value; domain=.wrox.com; path=/; secure\n\n// 格式\nname=value; expires=expiration_time; path=domain_path;\ndomain=domain_name; secure;</code></pre></div>\n<p><strong>注意:</strong></p>\n<ul>\n<li>域、路径、失效时间和 secure 标志<strong>都是服务器给浏览器的指示</strong>，以指定何时应该发送 cookie。</li>\n<li>这些参数并不会作为发送到服务器的 cookie 信息的一部分，<strong>只有名值对儿才会被发送</strong>。</li>\n</ul>\n<p><strong>获取:</strong></p>\n<p><code class=\"language-text\">document.cookie</code> 返回当前页面<strong>可用的</strong>（根据 cookie 的域、路径、失效时间和安全设置）所有 cookie 的字符串，一系列由分号隔开的名值对儿.</p>\n<p><strong>设置格式:</strong></p>\n<p>name=value; expires=expiration<em>time; path=domain</em>path; domain=domain_name; secure</p>\n<p><strong>HTTP 专有 cookie(HTTP only)</strong></p>\n<p>可以从浏览器或者服务器设置，但<strong>是只能从服务器端读取</strong>，因为 JavaScript 无法获取 HTTP 专有 cookie 的值。</p>\n<p>HTTPOnly 是一个方式 XSS 的手段, 是不再允许出现 js 操作 cookie 的场景了，但是自己也没法儿使用 js 操作 cookie 了. 会造成使用上和迁移上的麻烦.</p>\n<p><strong>javaEE 服务端这样设置:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">response<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Set-Cookie\"</span><span class=\"token punctuation\">,</span> \"cookiename<span class=\"token operator\">=</span>value<span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Path</span><span class=\"token operator\">=</span><span class=\"token operator\">/</span><span class=\"token punctuation\">;</span><span class=\"token class-name\">Domain</span><span class=\"token operator\">=</span>domainvalue<span class=\"token punctuation\">;</span><span class=\"token class-name\">Max</span><span class=\"token operator\">-</span><span class=\"token class-name\">Age</span><span class=\"token operator\">=</span>seconds<span class=\"token punctuation\">;</span><span class=\"token class-name\">HTTPOnly</span>\"<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"4-sessionstorage-localstorage\" style=\"position:relative;\"><a href=\"#4-sessionstorage-localstorage\" aria-label=\"4 sessionstorage localstorage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. sessionStorage, localStorage</h3>\n<ul>\n<li>storage 事件, 用于跨 tab 通信</li>\n<li>5MB 存储限制</li>\n</ul>\n<h3 id=\"5-如果-cookie-中未设置过期时间会如何\" style=\"position:relative;\"><a href=\"#5-%E5%A6%82%E6%9E%9C-cookie-%E4%B8%AD%E6%9C%AA%E8%AE%BE%E7%BD%AE%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4%E4%BC%9A%E5%A6%82%E4%BD%95\" aria-label=\"5 如果 cookie 中未设置过期时间会如何 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 如果 cookie 中未设置过期时间会如何?</h3>\n<p>服务器设置的 cookie 只在当期会话有效, 关闭浏览器后删除对应 cookie.</p>\n<h3 id=\"6-js-本地操作-cookie-的处理流程有哪些\" style=\"position:relative;\"><a href=\"#6-js-%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C-cookie-%E7%9A%84%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E6%9C%89%E5%93%AA%E4%BA%9B\" aria-label=\"6 js 本地操作 cookie 的处理流程有哪些 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. JS 本地操作 cookie 的处理流程有哪些?</h3>\n<p>一般分为: <code class=\"language-text\">get()</code> / <code class=\"language-text\">set()</code> / <code class=\"language-text\">remove()</code></p>\n<p><strong><code class=\"language-text\">get(name)</code></strong></p>\n<blockquote>\n<p><strong>注意<code class=\"language-text\">name</code>需要<code class=\"language-text\">encodeURIComponent</code>处理, 返回的值需要<code class=\"language-text\">decodeURIComponent</code></strong></p>\n</blockquote>\n<ul>\n<li>找到<code class=\"language-text\">name</code>的 startIndex</li>\n<li>从 index 开始找结尾标志<code class=\"language-text\">;</code>的 endIndex, 如果未找到则到了 cookie 末端, endIndex 为 cookie 字符串长度</li>\n<li>根据起止位置用 <code class=\"language-text\">substring(startIndex+name.length, endIndex)</code> 截取字符串返回</li>\n</ul>\n<p><strong><code class=\"language-text\">set(name, value, expires, path, domain, secure)</code></strong></p>\n<blockquote>\n<p>设置 cookie 可以不用管原先已存储的值, 如果浏览器中 cookie 已存在则覆盖, 不存在则新增, 我们只需要传递修改的字符串即可</p>\n</blockquote>\n<ul>\n<li>将<code class=\"language-text\">name</code>和<code class=\"language-text\">value</code>进行<code class=\"language-text\">encodeURIComponent</code>, 根据传入的配置拼接字符串</li>\n<li>将值转给<code class=\"language-text\">document.cookie</code></li>\n</ul>\n<p><strong><code class=\"language-text\">remove(key, options)</code></strong></p>\n<blockquote>\n<p>cookie 不可以删除, 需要使用相同的路径、域和安全选项再次设置 cookie，并将失效时间设置为过去的时间。</p>\n</blockquote>\n<p>等效代码:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> domain<span class=\"token punctuation\">,</span> secure<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"7-sessionstorage-和-localstorage-使用的差别？\" style=\"position:relative;\"><a href=\"#7-sessionstorage-%E5%92%8C-localstorage-%E4%BD%BF%E7%94%A8%E7%9A%84%E5%B7%AE%E5%88%AB%EF%BC%9F\" aria-label=\"7 sessionstorage 和 localstorage 使用的差别？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. sessionStorage 和 localStorage 使用的差别？</h3>\n<ul>\n<li>sessionStorage 中的数据在<strong>当前会话期</strong>存在，而 localStorage 则一直存在</li>\n<li><strong>localStorage 中新增数据可以在其他 Tab 中同步</strong>，但是 sessionStorage 不会同步</li>\n</ul>","timeToRead":4,"wordCount":{"paragraphs":50,"sentences":52,"words":194},"fields":{"slug":"/di-er-shi-san-zhang/","relativePath":"2018/2018-03-18---di-er-shi-san-zhang/index.md"},"excerpt":"1. 如何判断在线状态? 属性: 事件: 2. manifest 应用缓存 看下 Gatsby 的实现. 书上说的和 Gatsby 实现的方式不一样. gatsby-plugin-offline gatsby…","frontmatter":{"title":"第二十三章 离线应用与客户端存储","date":"18 Mar 2018","tags":["JS高程"],"cover":"","comments":true,"author":"烈风裘"}},"nextPost":{"html":"<h3 id=\"1-json-和-javascript-的关系\" style=\"position:relative;\"><a href=\"#1-json-%E5%92%8C-javascript-%E7%9A%84%E5%85%B3%E7%B3%BB\" aria-label=\"1 json 和 javascript 的关系 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. JSON 和 JavaScript 的关系?</h3>\n<ul>\n<li>JSON 并不从属于 JavaScript</li>\n<li>JSON 是一种数据格式, 而不是编程语言</li>\n<li>JSON 可表示的数据类型有: 对象/数组/字符串/数字/布尔值/null, 其余类型忽略.</li>\n</ul>\n<h3 id=\"2-除了使用全局对象code-classlanguage-textjsoncode解析-json-还有什么方法-问题点是\" style=\"position:relative;\"><a href=\"#2-%E9%99%A4%E4%BA%86%E4%BD%BF%E7%94%A8%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1code-classlanguage-textjsoncode%E8%A7%A3%E6%9E%90-json-%E8%BF%98%E6%9C%89%E4%BB%80%E4%B9%88%E6%96%B9%E6%B3%95-%E9%97%AE%E9%A2%98%E7%82%B9%E6%98%AF\" aria-label=\"2 除了使用全局对象code classlanguage textjsoncode解析 json 还有什么方法 问题点是 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 除了使用全局对象<code class=\"language-text\">JSON</code>解析 JSON 还有什么方法? 问题点是?</h3>\n<p>还有<code class=\"language-text\">eval()</code>方法可以解析, 问题点是:</p>\n<ul>\n<li><code class=\"language-text\">eval()</code>中可能有恶意代码</li>\n<li>性能不高</li>\n</ul>\n<blockquote>\n<p>支持<code class=\"language-text\">JSON</code>的的浏览器, IE8+</p>\n</blockquote>\n<h3 id=\"3-code-classlanguage-textjsonstringifyobjcode时的注意点\" style=\"position:relative;\"><a href=\"#3-code-classlanguage-textjsonstringifyobjcode%E6%97%B6%E7%9A%84%E6%B3%A8%E6%84%8F%E7%82%B9\" aria-label=\"3 code classlanguage textjsonstringifyobjcode时的注意点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. <code class=\"language-text\">JSON.stringify(obj)</code>时的注意点?</h3>\n<ul>\n<li><strong>不能保存函数</strong>, 如果有函数会忽略</li>\n<li>值为<strong><code class=\"language-text\">undefined</code></strong>会被忽略</li>\n</ul>\n<h3 id=\"4-解释下执行code-classlanguage-textjsonstringifycode这个函数发生的内部流程\" style=\"position:relative;\"><a href=\"#4-%E8%A7%A3%E9%87%8A%E4%B8%8B%E6%89%A7%E8%A1%8Ccode-classlanguage-textjsonstringifycode%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%8F%91%E7%94%9F%E7%9A%84%E5%86%85%E9%83%A8%E6%B5%81%E7%A8%8B\" aria-label=\"4 解释下执行code classlanguage textjsonstringifycode这个函数发生的内部流程 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 解释下执行<code class=\"language-text\">JSON.stringify</code>这个函数发生的内部流程?</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  str<span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n  num<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">fn</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"num:\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  trans<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">toJSON</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  arr<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"str\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"num\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"trans\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"arr\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>流程</strong></p>\n<ol>\n<li>如果对象中存在 toJSON 方法, 则执行他获得有效值. 否则返回对象本身. (上面例子最外层对象没有)</li>\n<li>如果提供了第二个参数, 则执行过滤操作. <strong>传入函数过滤器的(key, value)是第一步返回的值</strong></li>\n<li>先从最外层对象开始, 如果内层遍历到对象, 则转到 1)</li>\n<li>对第 2)返回的每个值进行序列化</li>\n<li>如果提供了第三个参数, 则进行对应格式化</li>\n</ol>\n<blockquote>\n<p>注意:</p>\n<ol>\n<li>可以控制整个对象的 toJSON 之外, 还可以控制某个属性的 toJSON.</li>\n<li>第三个参数是格式化参数, 可以是字符串用于填充间隙</li>\n</ol>\n</blockquote>\n<h3 id=\"5-code-classlanguage-textjsonparsecode中的还原函数\" style=\"position:relative;\"><a href=\"#5-code-classlanguage-textjsonparsecode%E4%B8%AD%E7%9A%84%E8%BF%98%E5%8E%9F%E5%87%BD%E6%95%B0\" aria-label=\"5 code classlanguage textjsonparsecode中的还原函数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. <code class=\"language-text\">JSON.parse</code>中的还原函数?</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> book <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  title<span class=\"token operator\">:</span> <span class=\"token string\">\"Professional JavaScript\"</span><span class=\"token punctuation\">,</span>\n  authors<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Nicholas C. Zakas\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  edition<span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n  year<span class=\"token operator\">:</span> <span class=\"token number\">2011</span><span class=\"token punctuation\">,</span>\n  releaseDate<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token number\">2011</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>book<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n  <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key<span class=\"token punctuation\">,</span> value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">\"releaseDate\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">JSON.stringify</code>时, <code class=\"language-text\">Date</code>本身有自己的<code class=\"language-text\">toJSON</code>方法</li>\n<li><code class=\"language-text\">JSON.parse</code>时, 是不会有上面的逆过程, 需要手动操作, 因为, string 类型的值不知道之前发生了什么…</li>\n<li><code class=\"language-text\">JSON.parse</code>第二个参数成为: 还原函数, 函数传参和<code class=\"language-text\">JSON.stringify</code>的过滤函数一致(和<code class=\"language-text\">array.prototype.filter</code>过滤函数的机制不一样, 需注意)</li>\n</ul>","timeToRead":3,"wordCount":{"paragraphs":26,"sentences":30,"words":90},"fields":{"slug":"/di-20-zhang-json/","relativePath":"2018/2018-03-18---di-20-zhang-json/index.md"},"excerpt":"1. JSON 和 JavaScript 的关系? JSON 并不从属于 JavaScript JSON 是一种数据格式, 而不是编程语言 JSON 可表示的数据类型有: 对象/数组/字符串/数字/布尔值/null…","frontmatter":{"title":"第二十章 JSON","date":"18 Mar 2018","tags":["JS高程"],"cover":"","comments":true,"author":"烈风裘"}},"prevPost":{"html":"<h3 id=\"1-try-catch\" style=\"position:relative;\"><a href=\"#1-try-catch\" aria-label=\"1 try catch permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. try-catch</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 可能会导致错误的代码</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 在错误发生时怎么处理</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>在<strong>可能发生错误的地方使用 try-catch 语句</strong></li>\n<li>catch 中的 error 错误对象必须要写, 不可忽略</li>\n<li>error.message: 错误消息</li>\n<li>error.name: 错误名称</li>\n</ul>\n<h3 id=\"2-下面包含code-classlanguage-textfinallycode语句的代码返回值时\" style=\"position:relative;\"><a href=\"#2-%E4%B8%8B%E9%9D%A2%E5%8C%85%E5%90%ABcode-classlanguage-textfinallycode%E8%AF%AD%E5%8F%A5%E7%9A%84%E4%BB%A3%E7%A0%81%E8%BF%94%E5%9B%9E%E5%80%BC%E6%97%B6\" aria-label=\"2 下面包含code classlanguage textfinallycode语句的代码返回值时 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 下面包含<code class=\"language-text\">finally</code>语句的代码返回值时?</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">testFinally</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>finally 子句一经使用，其代码无论如何都会执行</li>\n<li>如果 finally 包含 return, 则会忽略上面的所有 return</li>\n<li>上例子中返回 0</li>\n</ul>\n<h3 id=\"3-报错的-error-类型种类-如何获取类型\" style=\"position:relative;\"><a href=\"#3-%E6%8A%A5%E9%94%99%E7%9A%84-error-%E7%B1%BB%E5%9E%8B%E7%A7%8D%E7%B1%BB-%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E7%B1%BB%E5%9E%8B\" aria-label=\"3 报错的 error 类型种类 如何获取类型 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 报错的 error 类型种类, 如何获取类型?</h3>\n<ul>\n<li>Error: 基类错误</li>\n<li>EvalError: 执行 eval()错误</li>\n<li>RangeError: 范围错误</li>\n<li>ReferenceError: 对象中属性未找到</li>\n<li>SyntaxError: 语法错误, 比如错误的字符串传入 <code class=\"language-text\">JSON.parse()</code> / <code class=\"language-text\">eval()</code></li>\n<li>TypeError: 类型错误</li>\n<li>URIError: 在使用 encodeURI()或 decodeURI(), uri 格式不对报错</li>\n</ul>\n<p>可以通过 <code class=\"language-text\">instanceof</code>操作符 获取错误类型.</p>\n<h3 id=\"4-如何创建自定义错误类型并抛出\" style=\"position:relative;\"><a href=\"#4-%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B%E5%B9%B6%E6%8A%9B%E5%87%BA\" aria-label=\"4 如何创建自定义错误类型并抛出 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 如何创建自定义错误类型并抛出?</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">CustomError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"CustomError\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>message <span class=\"token operator\">=</span> message<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">CustomError</span><span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">CustomError</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>constructor <span class=\"token operator\">=</span> CustomError<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomError</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"This is a message!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"5-在-try-catch-捕获错误和-throw-抛出错误两个阶段应该注意什么\" style=\"position:relative;\"><a href=\"#5-%E5%9C%A8-try-catch-%E6%8D%95%E8%8E%B7%E9%94%99%E8%AF%AF%E5%92%8C-throw-%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF%E4%B8%A4%E4%B8%AA%E9%98%B6%E6%AE%B5%E5%BA%94%E8%AF%A5%E6%B3%A8%E6%84%8F%E4%BB%80%E4%B9%88\" aria-label=\"5 在 try catch 捕获错误和 throw 抛出错误两个阶段应该注意什么 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 在 try-catch 捕获错误和 throw 抛出错误两个阶段应该注意什么?</h3>\n<ul>\n<li><strong>try-catch 捕获错误</strong>: 应该捕获确切知道如何处理的错误</li>\n<li><strong>throw 抛出</strong>: 错误应该提供详细的信息</li>\n</ul>\n<h3 id=\"6-error-事件触发时机\" style=\"position:relative;\"><a href=\"#6-error-%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91%E6%97%B6%E6%9C%BA\" aria-label=\"6 error 事件触发时机 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. error 事件触发时机?</h3>\n<p>任何没有通过 try-catch 处理的错误都会<strong>触发 window 对象的 error 事件</strong>。</p>\n<h3 id=\"7-error-事件监听\" style=\"position:relative;\"><a href=\"#7-error-%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC\" aria-label=\"7 error 事件监听 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. error 事件监听</h3>\n<p><strong>只能这样使用!!</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">window<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> line</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 阻止浏览器报告错误的默认行为</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>通过<strong>返回 false</strong>，这个函数实际上就<strong>充当了整个文档中的 try-catch 语句</strong>，可以捕获所有无代码处理的运行时错误。</li>\n<li>理想情况下，只要可能就不应该使用它</li>\n<li>只要能够适当地使用 try-catch 语句，就不会有错误交给浏览器，也就不会触发 error 事件。</li>\n</ul>\n<h3 id=\"8-常见错误如何避免\" style=\"position:relative;\"><a href=\"#8-%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D\" aria-label=\"8 常见错误如何避免 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. 常见错误如何避免?</h3>\n<p><strong>类型转化错误</strong></p>\n<ul>\n<li>使用<strong>全等<code class=\"language-text\">===</code></strong>和<strong>非全等<code class=\"language-text\">!==</code></strong>操作符，可以避免发生因为使用相等和不相等操作符引发的类型 转换错误，因此我们强烈推荐使用</li>\n<li>像 <code class=\"language-text\">if</code> 之类的语句在确定下一步操作之前， 会<strong>自动把任何值转换成布尔值</strong>, 避免错误就要做到在条件比较时<strong>切实传入布尔值</strong>。</li>\n</ul>\n<p><strong>数据类型错误</strong></p>\n<ul>\n<li>传参需要手动判断下类型, 避免错误</li>\n<li><strong>基本类型</strong>的值应该使用 <code class=\"language-text\">typeof</code> 来检测, string/number/function/boolean</li>\n<li><strong>对象</strong>的值则应该使用 <code class=\"language-text\">instanceof</code> 来检测, array/object</li>\n<li>基本库<strong>必须</strong>进行入参类型检查!</li>\n</ul>\n<p><strong>通信错误</strong></p>\n<ul>\n<li>url 编码错误, 比如没正确使用<code class=\"language-text\">encodeURIComponent</code>函数, 解决方式如下:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">addQueryStringArg</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"?\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    url <span class=\"token operator\">+=</span> <span class=\"token string\">\"?\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    url <span class=\"token operator\">+=</span> <span class=\"token string\">\"&amp;\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  url <span class=\"token operator\">+=</span> <span class=\"token function\">encodeURIComponent</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"=\"</span> <span class=\"token operator\">+</span> <span class=\"token function\">encodeURIComponent</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> url<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>在服务器响应的数据不正确时，也会发生通信错误</li>\n<li>动态加载脚本和动态加载样式</li>\n</ul>\n<h3 id=\"9-归一化-error-对象的方法\" style=\"position:relative;\"><a href=\"#9-%E5%BD%92%E4%B8%80%E5%8C%96-error-%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E6%B3%95\" aria-label=\"9 归一化 error 对象的方法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9. 归一化 error 对象的方法</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n * 监听全局的js文件错误\n * @param {String}  message   错误信息\n * @param {String}  script    出错的文件\n * @param {String}  line      出错代码的行号\n * @param {String}  column    出错代码的列号\n * @param {Object}  errorObj  错误的详细信息，Anything\n */</span>\nwindow<span class=\"token punctuation\">[</span><span class=\"token string\">\"onerror\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message<span class=\"token punctuation\">,</span> script<span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">,</span> column<span class=\"token punctuation\">,</span> errorObj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  _ins<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">normalizeError</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      message<span class=\"token operator\">:</span> message<span class=\"token punctuation\">,</span>\n      name<span class=\"token operator\">:</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>errorObj <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>errorObj<span class=\"token punctuation\">.</span>message <span class=\"token operator\">||</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\":\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      script<span class=\"token operator\">:</span> script<span class=\"token punctuation\">,</span>\n      line<span class=\"token operator\">:</span> line<span class=\"token punctuation\">,</span>\n      stack<span class=\"token operator\">:</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>errorObj <span class=\"token operator\">&amp;&amp;</span> errorObj<span class=\"token punctuation\">.</span>stack\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Normalize Error objects across all browsers into something semi-standard.</span>\n<span class=\"token comment\">// Not all properties are will be available, but if they are, they'll at</span>\n<span class=\"token comment\">// least have a predictable property name.</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">normalizeError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> o <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    message<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">,</span>\n    script<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>fileName <span class=\"token operator\">||</span> err<span class=\"token punctuation\">.</span>sourceURL <span class=\"token operator\">||</span> err<span class=\"token punctuation\">.</span>script<span class=\"token punctuation\">,</span>\n    name<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n    line<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>lineNumber <span class=\"token operator\">||</span> err<span class=\"token punctuation\">.</span>line<span class=\"token punctuation\">,</span>\n    stack<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>stackTrace <span class=\"token operator\">||</span> err<span class=\"token punctuation\">.</span>stack\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Chrome doesn't provide script/line # properties in Error objects, and</span>\n  <span class=\"token comment\">// only reports the script/line # of where an error was last rethrown (as</span>\n  <span class=\"token comment\">// opposed to the original throw point).  So we scrape the stack trace to</span>\n  <span class=\"token comment\">// get that info</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n    window<span class=\"token punctuation\">.</span>chrome <span class=\"token operator\">&amp;&amp;</span>\n    err<span class=\"token punctuation\">.</span>stack <span class=\"token operator\">&amp;&amp;</span>\n    <span class=\"token regex\">/(\\w{3,5}:\\/\\/[^:]+):(\\d+)/</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>stack<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    o<span class=\"token punctuation\">.</span>script <span class=\"token operator\">=</span> RegExp<span class=\"token punctuation\">.</span>$<span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    o<span class=\"token punctuation\">.</span>line <span class=\"token operator\">=</span> RegExp<span class=\"token punctuation\">.</span>$<span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// Clear out undefined properties</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> k <span class=\"token keyword\">in</span> o<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">delete</span> o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> o<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"10-如何捕获code-classlanguage-textpromisecode抛出的错误？\" style=\"position:relative;\"><a href=\"#10-%E5%A6%82%E4%BD%95%E6%8D%95%E8%8E%B7code-classlanguage-textpromisecode%E6%8A%9B%E5%87%BA%E7%9A%84%E9%94%99%E8%AF%AF%EF%BC%9F\" aria-label=\"10 如何捕获code classlanguage textpromisecode抛出的错误？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10. 如何捕获<code class=\"language-text\">Promise</code>抛出的错误？</h3>\n<h4 id=\"主动捕获\" style=\"position:relative;\"><a href=\"#%E4%B8%BB%E5%8A%A8%E6%8D%95%E8%8E%B7\" aria-label=\"主动捕获 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>主动捕获</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a:1\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">json</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"不会执行到这里\"</span><span class=\"token punctuation\">,</span> json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//这儿捕获的是上一个JSON.parse时的错误</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"上面err在这里被处理\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">//Unexpected token a</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"不会触发这个error\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"任然执行\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4 id=\"被动监听\" style=\"position:relative;\"><a href=\"#%E8%A2%AB%E5%8A%A8%E7%9B%91%E5%90%AC\" aria-label=\"被动监听 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>被动监听</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 浏览器</span>\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unhandledrejection\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// nodejs</span>\nprocess<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unhandledRejection\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">reason<span class=\"token punctuation\">,</span> promise</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reason<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [Error: unhandledrejection]</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>promise<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Promise { &lt;rejected> [Error: unhandledrejection] }</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>参考这篇文章，<a href=\"http://2ality.com/2016/04/unhandled-rejections.html\" target=\"_target\" rel=\"nofollow\">Tracking unhandled rejected Promises</a></p>","timeToRead":6,"wordCount":{"paragraphs":47,"sentences":47,"words":151},"fields":{"slug":"/di-shi-qi-zhang-cuo/","relativePath":"2018/2018-03-19---di-shi-qi-zhang-cuo/index.md"},"excerpt":"1. try-catch 在可能发生错误的地方使用 try-catch 语句 catch 中的 error 错误对象必须要写, 不可忽略 error.message: 错误消息 error.name: 错误名称…","frontmatter":{"title":"第十七章 错误处理及调试","date":"19 Mar 2018","tags":["JS高程"],"cover":"","comments":true,"author":"烈风裘"}}},"pageContext":{"curr":"/di-er-shi-san-zhang/","prev":"/di-shi-qi-zhang-cuo/","next":"/di-20-zhang-json/"}},"staticQueryHashes":["3240721340","63159454"]}