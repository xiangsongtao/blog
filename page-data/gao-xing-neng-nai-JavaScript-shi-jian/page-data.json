{"componentChunkName":"component---src-templates-blog-post-js","path":"/gao-xing-neng-nai-JavaScript-shi-jian/","result":{"data":{"site":{"siteMetadata":{"title":"Attila","cover":"/background/1.jpg","description":"Thoughts, stories and ideas.","keywords":["烈风裘的博客","X-Blog","Attila","Gatsby","前端成长记录"],"tagCover":"/background/5.jpg","archiveCover":"/background/escape-flight.png","siteUrl":"https://xiangst0816.github.io/blog","logo":"","navigation":true,"subscribe":true}},"allAuthorJson":{"totalCount":2,"edges":[{"node":{"id":"烈风裘","bio":"一往无前, 直到云开雾散!","avatar":"/avatar/avatar.png","cover":"/background/photo-1503197979108-c824168d51a8.jpeg","github":"https://github.com/xiangst0816","twitter":"","zhihu":"","weibo":"","facebook":"","website":"https://xiangst0816.github.io/blog/","location":"HangZhou, China"}},{"node":{"id":"WALL-E","bio":"还有要清理的吗?","avatar":"/avatar/cleaner.jpg","cover":"","github":null,"twitter":null,"zhihu":null,"weibo":null,"facebook":null,"website":null,"location":"Earth"}}]},"master":{"id":"烈风裘","bio":"一往无前, 直到云开雾散!","avatar":"/avatar/avatar.png","cover":"/background/photo-1503197979108-c824168d51a8.jpeg","github":"https://github.com/xiangst0816","twitter":"","zhihu":"","weibo":"","facebook":"","website":"https://xiangst0816.github.io/blog/","location":"HangZhou, China"},"currentPost":{"html":"<p>本总结是对《高性能 JavaScript》这本书的总结也是记录笔记,加深我对 JavaScript 的认识及实践技巧。</p>\n<h2 id=\"一、脚本的加载和执行\" style=\"position:relative;\"><a href=\"#%E4%B8%80%E3%80%81%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%92%8C%E6%89%A7%E8%A1%8C\" aria-label=\"一、脚本的加载和执行 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>一、脚本的加载和执行</h2>\n<p>一般来说，JavaScript 代码的执行会阻塞浏览器进行的其他程序，比如用户界面绘制。每次遇到<code class=\"language-text\">&lt;script&gt;</code>后，,页面都必须停下来等待代码下载并执行，然后再继续解析和渲染页面。在这期间，页面渲染和用户交互是完全被阻塞的，例如页面出现长时间的白屏。解决方案如下：</p>\n<ol>\n<li>将<code class=\"language-text\">&lt;script&gt;</code>放在<code class=\"language-text\">&lt;/body&gt;</code>之前，确保脚被执行前页面已完成渲染。</li>\n<li><code class=\"language-text\">&lt;script&gt;</code>标签越少越好，可以考虑用 gulp 任务合并。因为 HTTP 请求会带来额外的性能开销。</li>\n<li>内嵌脚本如果在<code class=\"language-text\">&lt;link&gt;</code>之后会导致页面阻塞去等待样式表的下载。这样能获得最精准的样式信息，但是会阻塞其他任务。（不建议，但 hack 除外）</li>\n<li>\n<p>使用无阻塞下载的方式</p>\n<ul>\n<li><strong>延迟脚本：</strong><br>\n在<code class=\"language-text\">&lt;script&gt;</code>标签中使用 defer 属性，该属性指明此脚本不会修改 DOM，因此可以安全的延迟执行。（async 属性也用于异步加载脚本，区别在于其加载完成后自动执行，而 defer 需要页面完成后才执行）</li>\n<li><strong>使用 XHR 对象下载 JavaScript 代码并注入到页面中</strong><br>\n主要的局限是只能在同域中请求 js 文件，也不能从 CDN 获取 js 文件。</li>\n<li><strong>动态脚本（推荐）：</strong><br>\n动态创建<code class=\"language-text\">&lt;script&gt;</code>元素并下载执行。即在 window 对象的 load 事件出发后再下载脚本。<br>\n可自己实现(如下)，也可使用类库:<a href=\"http://github.com/rgrove/lazyload/\" target=\"_target\" rel=\"nofollow\">lazyload</a>、<a href=\"http://labjs.com\" target=\"_target\" rel=\"nofollow\">LABjs</a>。</li>\n</ul>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/**\n * @title: addTags动态加载js标签\n * @params:\n * tagUrl: js资源的数组\n * eachLoadedCB: 每个资源加载完毕的回调\n * allLoadedCB: 所有资源加载完毕的回调\n * */\nfunction addTags(tagUrl, eachLoadedCB, allLoadedCB) {\n\n    if (!(tagUrl instanceof Array)) {\n        alert(&quot;first arguments must be array of urls&quot;);\n        return false;\n    }\n    var totalResource = tagUrl.length;\n    var restResource = totalResource;\n    var downLoadPercent;\n    for (var i = 0, len = tagUrl.length; len &gt; i; i++) {\n        //标签对象\n        var _TagObjs;\n        if (/.js$/.test(tagUrl[i])) {\n            _TagObjs = document.createElement(&quot;script&quot;);\n            _TagObjs.setAttribute(&#39;type&#39;, &#39;text/javascript&#39;);\n            _TagObjs.setAttribute(&#39;src&#39;, tagUrl[i]);\n            head.appendChild(_TagObjs);\n        }\n        if(_TagObjs.readyState){\n            //IE\n            _TagObjs.onreadystatechange = function () {\n                if(_TagObjs.readyState == &quot;loaded&quot; || _TagObjs.readyState == &quot;complete&quot;){\n                    _TagObjs.onreadystatechange = null;\n                    restResource--;\n                    downLoadPercent = Math.round((totalResource - restResource) / totalResource * 100);\n                    !!eachLoadedCB &amp;&amp; eachLoadedCB(totalResource, restResource, downLoadPercent);\n                    !!!restResource &amp;&amp; allLoadedCB &amp;&amp; allLoadedCB();\n                }\n            }\n        }else{\n            _TagObjs.onload = function () {\n                restResource--;\n                downLoadPercent = Math.round((totalResource - restResource) / totalResource * 100);\n                !!eachLoadedCB &amp;&amp; eachLoadedCB(totalResource, restResource, downLoadPercent);\n                !!!restResource &amp;&amp; allLoadedCB &amp;&amp; allLoadedCB();\n            };\n        }\n\n    }\n}\n\n\n/**\n * 使用\n * */\naddTags([&quot;core.js&quot;,&quot;lib.js&quot;],function (t,r,d) {\n    alert(&quot;total:&quot;+t+&quot;,rest:&quot;+r+&quot;,percent:&quot;+d);\n},function () {\n    alert(&quot;all loaded&quot;)\n})</code></pre></div>\n<h2 id=\"二、数据存储\" style=\"position:relative;\"><a href=\"#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8\" aria-label=\"二、数据存储 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>二、数据存储</h2>\n<p>JavaScript 的四种基本的数据存取位置，比较简单，这里只是简单列举：</p>\n<ul>\n<li>字面量 （最快）</li>\n<li>本地变量 （var 创建）（最快）</li>\n<li>数组元素 （最慢）</li>\n<li>对象成员（最慢）</li>\n</ul>\n<h3 id=\"作用域链\" style=\"position:relative;\"><a href=\"#%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE\" aria-label=\"作用域链 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>作用域链</h3>\n<p>找了一张图：\n<img src=\"http://img.my.csdn.net/uploads/201304/04/1365082234_1223.png\" alt=\"作用域链\"></p>\n<ul>\n<li>函数执行都会创建自己的执行环境，且执行环境都有自己的作用域链，用于解析标识符。函数运行时的变量对象会放在作用域链的顶端。当执行环境被销毁，此对象也随之销毁。故，在函数执行过程中，每遇到变量，都会经历一次标识符解析过程以决定从哪儿获取存储数据。---> <strong>藏的越深，找的越慢！</strong></li>\n<li>作用域链的末尾是全局变量对象，故<strong>搜索该变量的过程必须遍历整个作用域链！</strong>一般是讲此全局变量缓存的到局部变量中。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function init(){\n\tvar a = document;\n\tvar b = a.body;\n\tb.getElementByTagName(&quot;a&quot;);\n}</code></pre></div>\n<ul>\n<li>改变作用域链的方式有： - with(不建议使用，可使用局部变量替换) - try catch (可用)<br>\ntry 内函数的作用域对象放在首位，catch 内函数的作用域对象放在第二位。catch 执行完毕，作用域链就返回到之前的状态。<strong>建议将 catch 内的处理逻辑由专门的函数处理，由于只有一条执行语句，且没有局部变量的访问，作用域链的临时改变不会影响代码性能。</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">try{\n\tmethod();\n} catch(e){\n\thandleErr(e);\n}</code></pre></div>\n<h3 id=\"闭包、作用域和内存\" style=\"position:relative;\"><a href=\"#%E9%97%AD%E5%8C%85%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E5%86%85%E5%AD%98\" aria-label=\"闭包、作用域和内存 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>闭包、作用域和内存</h3>\n<ul>\n<li>闭包会造成更多的内存开销</li>\n<li>闭包会放在作用域链的顶端，第二层是活动对象的作用域，也就是说，闭包的存在会频繁的出现跨作用域访问标识符的情况，每次访问都会带来性能损失，解救方案：将常用的跨作用域的变量存储到局部变量中，然后直接访问局部变量。</li>\n</ul>\n<h3 id=\"原型链\" style=\"position:relative;\"><a href=\"#%E5%8E%9F%E5%9E%8B%E9%93%BE\" aria-label=\"原型链 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>原型链</h3>\n<ul>\n<li>Javascript 中的对象是基于原型的。</li>\n<li>所有的对象都是 Object 的实例。</li>\n<li>实例继承了原型链中的所有成员，故原型决定了实例的类型！</li>\n</ul>\n<p>浏览器中的原型链结构:\n<img src=\"http://images.cnitblog.com/blog/543993/201401/211448230160.jpg\" alt=\"浏览器中的原型链结构\"></p>\n<ul>\n<li>嵌套的对象成员会显著的影响性能，访问的速度也越慢,例如：<br>\nwindow.location.href.toString() > window.location.href > location.href</li>\n<li>缓存对象的成员，如果多次访问的话。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"vara = location;\"><pre class=\"language-vara = location;\"><code class=\"language-vara = location;\">\ta.href;\n\t....</code></pre></div>\n<ul>\n<li>属性和方法越深，访问的速度也越慢</li>\n</ul>\n<h2 id=\"三、dom-编程\" style=\"position:relative;\"><a href=\"#%E4%B8%89%E3%80%81dom-%E7%BC%96%E7%A8%8B\" aria-label=\"三、dom 编程 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>三、DOM 编程</h2>\n<ul>\n<li>减少 DOM 的访问次数，把运算留在 JS 端处理。</li>\n<li>遍历数组的速度快于遍历集合是速度，故将 HTML 集合转化为数组在进行处理会更高效。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function toArray(coll){\n\tfor(var i = 0,a = [],len = coll.length;i&lt;len;i++){\n\t\ta[i] = coll[i];\n\t}\n\treturn a;\n}\n\nvar coll = document.getElementsByTagName(&quot;div&quot;);\nvar ar = toArray(coll);</code></pre></div>\n<ul>\n<li>建议使用 querySlectorAll()方法</li>\n</ul>\n<h3 id=\"重绘和重排\" style=\"position:relative;\"><a href=\"#%E9%87%8D%E7%BB%98%E5%92%8C%E9%87%8D%E6%8E%92\" aria-label=\"重绘和重排 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>重绘和重排</h3>\n<ul>\n<li>重排：reflow，重新计算元素几何属性，重新构造渲染树，代价很高；</li>\n<li>重绘： repaint，代价相对较小。</li>\n</ul>\n<p>故：</p>\n<ul>\n<li>批量修改 DOM</li>\n<li>批量改变样式（ele.style.cssText = \"\"）</li>\n<li>使元素脱离文档流，避免大部分文档重排： - 动画元素绝对定位，脱离文档流</li>\n</ul>\n<h3 id=\"事件委托\" style=\"position:relative;\"><a href=\"#%E4%BA%8B%E4%BB%B6%E5%A7%94%E6%89%98\" aria-label=\"事件委托 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>事件委托</h3>\n<p>大量元素绑定相同处理事件的时候，将事件绑定到 document 上，通过冒泡事件捕获并处理</p>\n<h2 id=\"四、算法和流程控制\" style=\"position:relative;\"><a href=\"#%E5%9B%9B%E3%80%81%E7%AE%97%E6%B3%95%E5%92%8C%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6\" aria-label=\"四、算法和流程控制 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>四、算法和流程控制</h2>\n<ul>\n<li>for, while, do- while，性能相当，灵活使用</li>\n<li>避免使用 for-in，除非遍历对象的数量不确定。</li>\n<li>switch 和 if-else 灵活使用</li>\n<li>出现栈溢出，可能是因为使用了递归，将递归改为迭代可以避免。因为运行一个循环比反复调用一个函数的开销要少的多。</li>\n</ul>\n<h2 id=\"五、字符串和正则表达式\" style=\"position:relative;\"><a href=\"#%E4%BA%94%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F\" aria-label=\"五、字符串和正则表达式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>五、字符串和正则表达式</h2>\n<ul>\n<li>使用+和+=操作字符串，避免不必要的中间字符串</li>\n<li>正则，待续</li>\n</ul>\n<h2 id=\"六、快速响应用户界面\" style=\"position:relative;\"><a href=\"#%E5%85%AD%E3%80%81%E5%BF%AB%E9%80%9F%E5%93%8D%E5%BA%94%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2\" aria-label=\"六、快速响应用户界面 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>六、快速响应用户界面</h2>\n<ul>\n<li>js 任务不可超过 100ms</li>\n<li>使用 settimeout 将长时间的 js 放入队列中异步执行，不阻碍 ui 进程。</li>\n<li>可以使用 web works</li>\n</ul>\n<h2 id=\"七、ajax\" style=\"position:relative;\"><a href=\"#%E4%B8%83%E3%80%81ajax\" aria-label=\"七、ajax permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>七、AJAX</h2>\n<ul>\n<li>减少请求次数</li>\n</ul>\n<h2 id=\"八、编程实践\" style=\"position:relative;\"><a href=\"#%E5%85%AB%E3%80%81%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5\" aria-label=\"八、编程实践 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>八、编程实践</h2>\n<ul>\n<li>避免双重求值（使用 eval()和 Function()运行字符串代码）</li>\n<li>Object 和 Array 使用直接量，而不是 new</li>\n<li>环境判断的函数应该使用延迟加载技术（Lazy Loading）或者条件预加载技术（Conditional Advance Loading），即，环境确定后，用该环境下的函数替换主函数</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">//延迟加载技术（Lazy Loading）\n//第一次执行判断环境，之后修改addHandler函数并执行\nfunctin addHandler(x){\n\tif(isThisEnvironment){\n\t\taddHandler = function(x){}\n\t}else{\n\t\taddHandler = function(x){}\n\t}\n\taddHandler(x);\n}</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">//条件预加载技术（Conditional Advance Loading）\n//脚本加载期间检测，并修改addHandler函数；\nvar addHandler = isThisEnvironment?function(x){}:function(x){};</code></pre></div>\n<ul>\n<li>使用 js 原生提供的方法（Math）</li>\n<li>使用位操作</li>\n</ul>\n<h2 id=\"九、构建高性能-js-应用\" style=\"position:relative;\"><a href=\"#%E4%B9%9D%E3%80%81%E6%9E%84%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BD-js-%E5%BA%94%E7%94%A8\" aria-label=\"九、构建高性能 js 应用 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>九、构建高性能 js 应用</h2>\n<ul>\n<li>合并多个 JavaScript 文件，减少 HTTP 请求数</li>\n<li><strong>非必须的脚本延迟加载</strong></li>\n<li>JavaScript 压缩，方法：ugify、js 重构（GCC）</li>\n<li>启用 gzip</li>\n<li>manifest 缓存技术，包含 manifest 的 html 也会被缓存</li>\n<li>CDN</li>\n<li>文件名增加 MD5 值防止缓存更新问题</li>\n</ul>\n<h2 id=\"10、工具\" style=\"position:relative;\"><a href=\"#10%E3%80%81%E5%B7%A5%E5%85%B7\" aria-label=\"10、工具 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10、工具</h2>\n<ul>\n<li>分类：性能分析+网络分析</li>\n<li>浏览器的开发工具</li>\n<li>Fidder/postman/Charles Proxy</li>\n</ul>","timeToRead":8,"wordCount":{"paragraphs":78,"sentences":78,"words":322},"fields":{"slug":"/gao-xing-neng-nai-JavaScript-shi-jian/","relativePath":"2016/2016-05-21---gao-xing-neng-nai-JavaScript-shi-jian/index.md"},"excerpt":"本总结是对《高性能 JavaScript》这本书的总结也是记录笔记,加深我对 JavaScript 的认识及实践技巧。 一、脚本的加载和执行 一般来说，JavaScript…","frontmatter":{"title":"高性能JavaScript实践总结","date":"21 May 2016","tags":["JavaScript","读书笔记"],"cover":"","comments":true,"author":"烈风裘"}},"nextPost":{"html":"<blockquote>\n<p>我这是用的是这个插件<strong>jquery.lazyload.js</strong>,<a href=\"http://blog.csdn.net/zzqw199012/article/details/18707473\" target=\"_target\" rel=\"nofollow\">关于介绍也很多了</a>,我这里就只见上干货，就说怎么用开始，不过还是先介绍下他是干什么的，怎么干的。</p>\n</blockquote>\n<h2 id=\"1-做什么的\" style=\"position:relative;\"><a href=\"#1-%E5%81%9A%E4%BB%80%E4%B9%88%E7%9A%84\" aria-label=\"1 做什么的 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 做什么的</h2>\n<p><strong>图片延迟加载</strong>，等<strong>滚到图片的位置时才加载</strong>，后面的图片先不加载，故能<strong>避免卡顿</strong>，需要加载图片的时候，图片进行下载，等加载完毕后才出现，<strong>消除出现半幅图</strong>的情况（改善用户体验）</p>\n<h2 id=\"2-怎么干的\" style=\"position:relative;\"><a href=\"#2-%E6%80%8E%E4%B9%88%E5%B9%B2%E7%9A%84\" aria-label=\"2 怎么干的 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 怎么干的</h2>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lazy<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-original</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>img/example.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>640<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>480<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<ul>\n<li><strong>data-original</strong>:这个是真正要交加载的图片；</li>\n<li><strong>src</strong>：这个是占位图片，默认是 grey.gif，高度只有 1px；自动添加的。你不管。</li>\n<li><strong>height</strong>：<strong>这个并不是必须设定</strong>，如果没设定导致图片都堆到一起被看到，则启动加载（我测试过，没设定尺寸），so，你知道该怎么做，把图片包起来隔开。</li>\n</ul>\n<p>引入 jquery：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>jquery.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>jquery.lazyload.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>在 main.js 中写上：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">$(\"img.lazy\").lazyload();</code></pre></div>\n<p>这个例子我在<a href=\"https://github.com/xiangsongtao/HTML5-WebAPP-template\" target=\"_target\" rel=\"nofollow\">HTML5-WebAPP-template</a>这里用到过了，你可以尝试下。</p>\n<p><strong>如果使用的 requirejs 的话，这样做：</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/*如果将包通过bower引入的话,会自动在paths中添加的 */</span>\nrequire<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  paths<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    bootstrap<span class=\"token operator\">:</span> <span class=\"token string\">\"../../bower_components/bootstrap/dist/js/bootstrap\"</span><span class=\"token punctuation\">,</span>\n    domReady<span class=\"token operator\">:</span> <span class=\"token string\">\"vendor/domReady.min\"</span><span class=\"token punctuation\">,</span>\n    jquery<span class=\"token operator\">:</span> <span class=\"token string\">\"../../bower_components/jquery/dist/jquery\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"jquery.scrollstop\"</span><span class=\"token operator\">:</span>\n      <span class=\"token string\">\"../../bower_components/jquery_lazyload/jquery.scrollstop\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"jquery.lazyload\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"../../bower_components/jquery_lazyload/jquery.lazyload\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  shim<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"jquery.lazyload\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"jquery\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"jquery.scrollstop\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"jquery\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//先加载jquery插件及require和domReady模块</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"require\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"jquery\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"domReady\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"jquery.lazyload\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"jquery.scrollstop\"</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">require<span class=\"token punctuation\">,</span> $<span class=\"token punctuation\">,</span> domReady</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//之后通过require模块加载其余部分,当然这也是懒加载的方法</span>\n  <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"app\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">app<span class=\"token punctuation\">,</span> test</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">domReady</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">app</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img.lazy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">lazyload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"3-说下其他功能\" style=\"position:relative;\"><a href=\"#3-%E8%AF%B4%E4%B8%8B%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD\" aria-label=\"3 说下其他功能 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 说下其他功能</h2>\n<h3 id=\"31-设置加载阈值\" style=\"position:relative;\"><a href=\"#31-%E8%AE%BE%E7%BD%AE%E5%8A%A0%E8%BD%BD%E9%98%88%E5%80%BC\" aria-label=\"31 设置加载阈值 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.1 设置加载阈值</h3>\n<blockquote>\n<p>之前是“看到图片就加载”，现在是快到图片多少“<strong>阈值</strong>”的时候加载-提前一个距离加载。懂了不？</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img.lazy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">lazyload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//还有200px就出现在屏幕上了，现在加载</span>\n  threshold<span class=\"token operator\">:</span> <span class=\"token number\">200</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"32-使用-jquery-的事件触发-img-加载\" style=\"position:relative;\"><a href=\"#32-%E4%BD%BF%E7%94%A8-jquery-%E7%9A%84%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91-img-%E5%8A%A0%E8%BD%BD\" aria-label=\"32 使用 jquery 的事件触发 img 加载 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.2 使用 jquery 的事件触发 img 加载</h3>\n<blockquote>\n<p>之前是自动，现在<strong>根据事件触发加载</strong>，例如 click，mouseover。。。。。自定义事件也行。</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img.lazy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">lazyload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  event<span class=\"token operator\">:</span> <span class=\"token string\">\"click\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>自定义事件触发：sport 时间 5s 后触发 img 加载</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img.lazy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">lazyload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    event<span class=\"token operator\">:</span> <span class=\"token string\">\"sporty\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">$</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"load\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> timeout <span class=\"token operator\">=</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img.lazy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sporty\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"33-使用-img-显现效果\" style=\"position:relative;\"><a href=\"#33-%E4%BD%BF%E7%94%A8-img-%E6%98%BE%E7%8E%B0%E6%95%88%E6%9E%9C\" aria-label=\"33 使用 img 显现效果 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.3 使用 img 显现效果</h3>\n<blockquote>\n<p>img 下载好了后，用什么方式显现的问题，简单。应该使用的是 jquery 的动画，默认是用 show(),估估计能替换成别的动画库。</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img.lazy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">lazyload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  effect<span class=\"token operator\">:</span> <span class=\"token string\">\"fadeIn\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"34-如果-img-在一个-scroll-容器中（图片在带滚动条的容器里）\" style=\"position:relative;\"><a href=\"#34-%E5%A6%82%E6%9E%9C-img-%E5%9C%A8%E4%B8%80%E4%B8%AA-scroll-%E5%AE%B9%E5%99%A8%E4%B8%AD%EF%BC%88%E5%9B%BE%E7%89%87%E5%9C%A8%E5%B8%A6%E6%BB%9A%E5%8A%A8%E6%9D%A1%E7%9A%84%E5%AE%B9%E5%99%A8%E9%87%8C%EF%BC%89\" aria-label=\"34 如果 img 在一个 scroll 容器中（图片在带滚动条的容器里） permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.4 如果 img 在一个 scroll 容器中（图片在带滚动条的容器里）</h3>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">#container</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 600px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> scroll<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img.lazy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">lazyload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  container<span class=\"token operator\">:</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#container\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"35-如果-img-不是呈现队列的形式布局的\" style=\"position:relative;\"><a href=\"#35-%E5%A6%82%E6%9E%9C-img-%E4%B8%8D%E6%98%AF%E5%91%88%E7%8E%B0%E9%98%9F%E5%88%97%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%B8%83%E5%B1%80%E7%9A%84\" aria-label=\"35 如果 img 不是呈现队列的形式布局的 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.5 如果 img 不是呈现队列的形式布局的</h3>\n<blockquote>\n<p>这句话的意思是，我们默认：图片的出现顺序是与 dom 的结构顺序是一致的。可是有些时髦的布局会将当前该出现的 img 放到很远的地方，所以这个插件为了保证这个图片能够显示出来，就会在后面去找（如果找不到这个图片就在页显示不出来了），看能不能找到这个图片，就是这个值“failure_limit”，如果你的布局非常奇葩，那么，将这个值设为 “所有使用 lazy 功能的图片的总和”，这样，这个奇葩的图片就跑不掉了！呵呵。理解了不？</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img.lazy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">lazyload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//向后找10个单位img</span>\n  failure_limit<span class=\"token operator\">:</span> <span class=\"token number\">10</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"36-如果图片不可见怎么办\" style=\"position:relative;\"><a href=\"#36-%E5%A6%82%E6%9E%9C%E5%9B%BE%E7%89%87%E4%B8%8D%E5%8F%AF%E8%A7%81%E6%80%8E%E4%B9%88%E5%8A%9E\" aria-label=\"36 如果图片不可见怎么办 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.6 如果图片不可见怎么办</h3>\n<blockquote>\n<p>跳过不可见的图片（Invisible）</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img.lazy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">lazyload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  skip_invisible<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","timeToRead":5,"wordCount":{"paragraphs":26,"sentences":26,"words":130},"fields":{"slug":"/imgLazyloadJS/","relativePath":"2015/2015-12-10---imgLazyloadJS/index.md"},"excerpt":"我这是用的是这个插件jquery.lazyload.js,关于介绍也很多了,我这里就只见上干货，就说怎么用开始，不过还是先介绍下他是干什么的，怎么干的。…","frontmatter":{"title":"imgLazyloadJS","date":"10 Dec 2015","tags":["JavaScript"],"cover":"","comments":true,"author":"烈风裘"}},"prevPost":{"html":"<p>WebP 是一种图片压缩格式，主要应用在网络中传输图片，减小带宽及存储空间。在相同的精细度的情况下，WebP 拥有更小的文件尺寸，其在 Google 的产品中广为应用。</p>\n<h3 id=\"使用场景\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF\" aria-label=\"使用场景 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用场景</h3>\n<ol>\n<li>桌面浏览器： 谷歌浏览器能完全展示，但是 Firefox 不行</li>\n<li>手机浏览器：完全不行，例如 IOS 的 Safari 及微信浏览器</li>\n<li>APP：Android 和 IOS 图片展示需要专门的解析库</li>\n</ol>\n<h3 id=\"app-中使用特性\" style=\"position:relative;\"><a href=\"#app-%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%89%B9%E6%80%A7\" aria-label=\"app 中使用特性 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>APP 中使用特性</h3>\n<h4 id=\"解析性能\" style=\"position:relative;\"><a href=\"#%E8%A7%A3%E6%9E%90%E6%80%A7%E8%83%BD\" aria-label=\"解析性能 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>解析性能</h4>\n<p>其中解码时间，WebP 的解码时间是 PNG 格式的 4.4 ~ 5 倍，流畅度、CPU 使用时间、内存占用无明显差异</p>\n<h4 id=\"最优方案\" style=\"position:relative;\"><a href=\"#%E6%9C%80%E4%BC%98%E6%96%B9%E6%A1%88\" aria-label=\"最优方案 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>最优方案</h4>\n<ul>\n<li>图片规格</li>\n</ul>\n<p>可以考虑使用 16n*16n 的规格，例如 256*256 或者 192*192 能获得更高的 WebP 压缩效率。</p>\n<ul>\n<li>色彩数</li>\n</ul>\n<p>建议原创表情尽量控制颜色数在 256 色以内，采用无损压缩性价比最高。</p>\n<ul>\n<li>色温、渐变与杂色、直线与直线、描边</li>\n</ul>\n<p>用色少，颜色渐变合理，装饰元素少，画面简单的</p>\n<h3 id=\"总结\" style=\"position:relative;\"><a href=\"#%E6%80%BB%E7%BB%93\" aria-label=\"总结 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>总结</h3>\n<p>谨慎使用！！</p>\n<h3 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h3>\n<ul>\n<li><a href=\"http://isux.tencent.com/introduction-of-webp.html\" target=\"_target\" rel=\"nofollow\">WebP 探寻之路</a></li>\n</ul>","timeToRead":1,"wordCount":{"paragraphs":19,"sentences":19,"words":76},"fields":{"slug":"/webp/","relativePath":"2016/2016-10-17---webp/index.md"},"excerpt":"WebP 是一种图片压缩格式，主要应用在网络中传输图片，减小带宽及存储空间。在相同的精细度的情况下，WebP 拥有更小的文件尺寸，其在 Google…","frontmatter":{"title":"webp","date":"17 Oct 2016","tags":["WebP"],"cover":"","comments":true,"author":"烈风裘"}}},"pageContext":{"curr":"/gao-xing-neng-nai-JavaScript-shi-jian/","prev":"/webp/","next":"/imgLazyloadJS/"}},"staticQueryHashes":["3240721340","63159454"]}