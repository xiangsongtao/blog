{"componentChunkName":"component---src-templates-blog-post-js","path":"/di-shi-qi-zhang-cuo/","result":{"data":{"site":{"siteMetadata":{"title":"Attila","cover":"/background/1.jpg","description":"Thoughts, stories and ideas.","keywords":["烈风裘的博客","X-Blog","Attila","Gatsby","前端成长记录"],"tagCover":"/background/5.jpg","archiveCover":"/background/escape-flight.png","siteUrl":"https://xiangst0816.github.io/blog","logo":"","navigation":true,"subscribe":true}},"allAuthorJson":{"totalCount":2,"edges":[{"node":{"id":"烈风裘","bio":"一往无前, 直到云开雾散!","avatar":"/avatar/avatar.png","cover":"/background/photo-1503197979108-c824168d51a8.jpeg","github":"https://github.com/xiangst0816","twitter":"","zhihu":"","weibo":"","facebook":"","website":"https://xiangst0816.github.io/blog/","location":"HangZhou, China"}},{"node":{"id":"WALL-E","bio":"还有要清理的吗?","avatar":"/avatar/cleaner.jpg","cover":"","github":null,"twitter":null,"zhihu":null,"weibo":null,"facebook":null,"website":null,"location":"Earth"}}]},"master":{"id":"烈风裘","bio":"一往无前, 直到云开雾散!","avatar":"/avatar/avatar.png","cover":"/background/photo-1503197979108-c824168d51a8.jpeg","github":"https://github.com/xiangst0816","twitter":"","zhihu":"","weibo":"","facebook":"","website":"https://xiangst0816.github.io/blog/","location":"HangZhou, China"},"currentPost":{"html":"<h3 id=\"1-try-catch\" style=\"position:relative;\"><a href=\"#1-try-catch\" aria-label=\"1 try catch permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. try-catch</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 可能会导致错误的代码</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 在错误发生时怎么处理</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>在<strong>可能发生错误的地方使用 try-catch 语句</strong></li>\n<li>catch 中的 error 错误对象必须要写, 不可忽略</li>\n<li>error.message: 错误消息</li>\n<li>error.name: 错误名称</li>\n</ul>\n<h3 id=\"2-下面包含code-classlanguage-textfinallycode语句的代码返回值时\" style=\"position:relative;\"><a href=\"#2-%E4%B8%8B%E9%9D%A2%E5%8C%85%E5%90%ABcode-classlanguage-textfinallycode%E8%AF%AD%E5%8F%A5%E7%9A%84%E4%BB%A3%E7%A0%81%E8%BF%94%E5%9B%9E%E5%80%BC%E6%97%B6\" aria-label=\"2 下面包含code classlanguage textfinallycode语句的代码返回值时 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 下面包含<code class=\"language-text\">finally</code>语句的代码返回值时?</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">testFinally</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>finally 子句一经使用，其代码无论如何都会执行</li>\n<li>如果 finally 包含 return, 则会忽略上面的所有 return</li>\n<li>上例子中返回 0</li>\n</ul>\n<h3 id=\"3-报错的-error-类型种类-如何获取类型\" style=\"position:relative;\"><a href=\"#3-%E6%8A%A5%E9%94%99%E7%9A%84-error-%E7%B1%BB%E5%9E%8B%E7%A7%8D%E7%B1%BB-%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E7%B1%BB%E5%9E%8B\" aria-label=\"3 报错的 error 类型种类 如何获取类型 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 报错的 error 类型种类, 如何获取类型?</h3>\n<ul>\n<li>Error: 基类错误</li>\n<li>EvalError: 执行 eval()错误</li>\n<li>RangeError: 范围错误</li>\n<li>ReferenceError: 对象中属性未找到</li>\n<li>SyntaxError: 语法错误, 比如错误的字符串传入 <code class=\"language-text\">JSON.parse()</code> / <code class=\"language-text\">eval()</code></li>\n<li>TypeError: 类型错误</li>\n<li>URIError: 在使用 encodeURI()或 decodeURI(), uri 格式不对报错</li>\n</ul>\n<p>可以通过 <code class=\"language-text\">instanceof</code>操作符 获取错误类型.</p>\n<h3 id=\"4-如何创建自定义错误类型并抛出\" style=\"position:relative;\"><a href=\"#4-%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B%E5%B9%B6%E6%8A%9B%E5%87%BA\" aria-label=\"4 如何创建自定义错误类型并抛出 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 如何创建自定义错误类型并抛出?</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">CustomError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"CustomError\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>message <span class=\"token operator\">=</span> message<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">CustomError</span><span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">CustomError</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>constructor <span class=\"token operator\">=</span> CustomError<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomError</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"This is a message!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"5-在-try-catch-捕获错误和-throw-抛出错误两个阶段应该注意什么\" style=\"position:relative;\"><a href=\"#5-%E5%9C%A8-try-catch-%E6%8D%95%E8%8E%B7%E9%94%99%E8%AF%AF%E5%92%8C-throw-%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF%E4%B8%A4%E4%B8%AA%E9%98%B6%E6%AE%B5%E5%BA%94%E8%AF%A5%E6%B3%A8%E6%84%8F%E4%BB%80%E4%B9%88\" aria-label=\"5 在 try catch 捕获错误和 throw 抛出错误两个阶段应该注意什么 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 在 try-catch 捕获错误和 throw 抛出错误两个阶段应该注意什么?</h3>\n<ul>\n<li><strong>try-catch 捕获错误</strong>: 应该捕获确切知道如何处理的错误</li>\n<li><strong>throw 抛出</strong>: 错误应该提供详细的信息</li>\n</ul>\n<h3 id=\"6-error-事件触发时机\" style=\"position:relative;\"><a href=\"#6-error-%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91%E6%97%B6%E6%9C%BA\" aria-label=\"6 error 事件触发时机 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. error 事件触发时机?</h3>\n<p>任何没有通过 try-catch 处理的错误都会<strong>触发 window 对象的 error 事件</strong>。</p>\n<h3 id=\"7-error-事件监听\" style=\"position:relative;\"><a href=\"#7-error-%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC\" aria-label=\"7 error 事件监听 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. error 事件监听</h3>\n<p><strong>只能这样使用!!</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">window<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> line</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 阻止浏览器报告错误的默认行为</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>通过<strong>返回 false</strong>，这个函数实际上就<strong>充当了整个文档中的 try-catch 语句</strong>，可以捕获所有无代码处理的运行时错误。</li>\n<li>理想情况下，只要可能就不应该使用它</li>\n<li>只要能够适当地使用 try-catch 语句，就不会有错误交给浏览器，也就不会触发 error 事件。</li>\n</ul>\n<h3 id=\"8-常见错误如何避免\" style=\"position:relative;\"><a href=\"#8-%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D\" aria-label=\"8 常见错误如何避免 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. 常见错误如何避免?</h3>\n<p><strong>类型转化错误</strong></p>\n<ul>\n<li>使用<strong>全等<code class=\"language-text\">===</code></strong>和<strong>非全等<code class=\"language-text\">!==</code></strong>操作符，可以避免发生因为使用相等和不相等操作符引发的类型 转换错误，因此我们强烈推荐使用</li>\n<li>像 <code class=\"language-text\">if</code> 之类的语句在确定下一步操作之前， 会<strong>自动把任何值转换成布尔值</strong>, 避免错误就要做到在条件比较时<strong>切实传入布尔值</strong>。</li>\n</ul>\n<p><strong>数据类型错误</strong></p>\n<ul>\n<li>传参需要手动判断下类型, 避免错误</li>\n<li><strong>基本类型</strong>的值应该使用 <code class=\"language-text\">typeof</code> 来检测, string/number/function/boolean</li>\n<li><strong>对象</strong>的值则应该使用 <code class=\"language-text\">instanceof</code> 来检测, array/object</li>\n<li>基本库<strong>必须</strong>进行入参类型检查!</li>\n</ul>\n<p><strong>通信错误</strong></p>\n<ul>\n<li>url 编码错误, 比如没正确使用<code class=\"language-text\">encodeURIComponent</code>函数, 解决方式如下:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">addQueryStringArg</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"?\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    url <span class=\"token operator\">+=</span> <span class=\"token string\">\"?\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    url <span class=\"token operator\">+=</span> <span class=\"token string\">\"&amp;\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  url <span class=\"token operator\">+=</span> <span class=\"token function\">encodeURIComponent</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"=\"</span> <span class=\"token operator\">+</span> <span class=\"token function\">encodeURIComponent</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> url<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>在服务器响应的数据不正确时，也会发生通信错误</li>\n<li>动态加载脚本和动态加载样式</li>\n</ul>\n<h3 id=\"9-归一化-error-对象的方法\" style=\"position:relative;\"><a href=\"#9-%E5%BD%92%E4%B8%80%E5%8C%96-error-%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E6%B3%95\" aria-label=\"9 归一化 error 对象的方法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9. 归一化 error 对象的方法</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n * 监听全局的js文件错误\n * @param {String}  message   错误信息\n * @param {String}  script    出错的文件\n * @param {String}  line      出错代码的行号\n * @param {String}  column    出错代码的列号\n * @param {Object}  errorObj  错误的详细信息，Anything\n */</span>\nwindow<span class=\"token punctuation\">[</span><span class=\"token string\">\"onerror\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message<span class=\"token punctuation\">,</span> script<span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">,</span> column<span class=\"token punctuation\">,</span> errorObj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  _ins<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">normalizeError</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      message<span class=\"token operator\">:</span> message<span class=\"token punctuation\">,</span>\n      name<span class=\"token operator\">:</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>errorObj <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>errorObj<span class=\"token punctuation\">.</span>message <span class=\"token operator\">||</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\":\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      script<span class=\"token operator\">:</span> script<span class=\"token punctuation\">,</span>\n      line<span class=\"token operator\">:</span> line<span class=\"token punctuation\">,</span>\n      stack<span class=\"token operator\">:</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>errorObj <span class=\"token operator\">&amp;&amp;</span> errorObj<span class=\"token punctuation\">.</span>stack\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Normalize Error objects across all browsers into something semi-standard.</span>\n<span class=\"token comment\">// Not all properties are will be available, but if they are, they'll at</span>\n<span class=\"token comment\">// least have a predictable property name.</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">normalizeError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> o <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    message<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">,</span>\n    script<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>fileName <span class=\"token operator\">||</span> err<span class=\"token punctuation\">.</span>sourceURL <span class=\"token operator\">||</span> err<span class=\"token punctuation\">.</span>script<span class=\"token punctuation\">,</span>\n    name<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n    line<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>lineNumber <span class=\"token operator\">||</span> err<span class=\"token punctuation\">.</span>line<span class=\"token punctuation\">,</span>\n    stack<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>stackTrace <span class=\"token operator\">||</span> err<span class=\"token punctuation\">.</span>stack\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Chrome doesn't provide script/line # properties in Error objects, and</span>\n  <span class=\"token comment\">// only reports the script/line # of where an error was last rethrown (as</span>\n  <span class=\"token comment\">// opposed to the original throw point).  So we scrape the stack trace to</span>\n  <span class=\"token comment\">// get that info</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n    window<span class=\"token punctuation\">.</span>chrome <span class=\"token operator\">&amp;&amp;</span>\n    err<span class=\"token punctuation\">.</span>stack <span class=\"token operator\">&amp;&amp;</span>\n    <span class=\"token regex\">/(\\w{3,5}:\\/\\/[^:]+):(\\d+)/</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>stack<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    o<span class=\"token punctuation\">.</span>script <span class=\"token operator\">=</span> RegExp<span class=\"token punctuation\">.</span>$<span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    o<span class=\"token punctuation\">.</span>line <span class=\"token operator\">=</span> RegExp<span class=\"token punctuation\">.</span>$<span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// Clear out undefined properties</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> k <span class=\"token keyword\">in</span> o<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">delete</span> o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> o<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"10-如何捕获code-classlanguage-textpromisecode抛出的错误？\" style=\"position:relative;\"><a href=\"#10-%E5%A6%82%E4%BD%95%E6%8D%95%E8%8E%B7code-classlanguage-textpromisecode%E6%8A%9B%E5%87%BA%E7%9A%84%E9%94%99%E8%AF%AF%EF%BC%9F\" aria-label=\"10 如何捕获code classlanguage textpromisecode抛出的错误？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10. 如何捕获<code class=\"language-text\">Promise</code>抛出的错误？</h3>\n<h4 id=\"主动捕获\" style=\"position:relative;\"><a href=\"#%E4%B8%BB%E5%8A%A8%E6%8D%95%E8%8E%B7\" aria-label=\"主动捕获 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>主动捕获</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a:1\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">json</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"不会执行到这里\"</span><span class=\"token punctuation\">,</span> json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//这儿捕获的是上一个JSON.parse时的错误</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"上面err在这里被处理\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">//Unexpected token a</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"不会触发这个error\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"任然执行\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4 id=\"被动监听\" style=\"position:relative;\"><a href=\"#%E8%A2%AB%E5%8A%A8%E7%9B%91%E5%90%AC\" aria-label=\"被动监听 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>被动监听</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 浏览器</span>\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unhandledrejection\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// nodejs</span>\nprocess<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unhandledRejection\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">reason<span class=\"token punctuation\">,</span> promise</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reason<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [Error: unhandledrejection]</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>promise<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Promise { &lt;rejected> [Error: unhandledrejection] }</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>参考这篇文章，<a href=\"http://2ality.com/2016/04/unhandled-rejections.html\" target=\"_target\" rel=\"nofollow\">Tracking unhandled rejected Promises</a></p>","timeToRead":6,"wordCount":{"paragraphs":47,"sentences":47,"words":151},"fields":{"slug":"/di-shi-qi-zhang-cuo/","relativePath":"2018/2018-03-19---di-shi-qi-zhang-cuo/index.md"},"excerpt":"1. try-catch 在可能发生错误的地方使用 try-catch 语句 catch 中的 error 错误对象必须要写, 不可忽略 error.message: 错误消息 error.name: 错误名称…","frontmatter":{"title":"第十七章 错误处理及调试","date":"19 Mar 2018","tags":["JS高程"],"cover":"","comments":true,"author":"烈风裘"}},"nextPost":{"html":"<h3 id=\"1-如何判断在线状态\" style=\"position:relative;\"><a href=\"#1-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E5%9C%A8%E7%BA%BF%E7%8A%B6%E6%80%81\" aria-label=\"1 如何判断在线状态 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 如何判断在线状态?</h3>\n<p><strong>属性:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">navigator<span class=\"token punctuation\">.</span>onLine<span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>事件:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">EventUtil<span class=\"token punctuation\">.</span><span class=\"token function\">addHandler</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">,</span> <span class=\"token string\">\"online\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Online\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nEventUtil<span class=\"token punctuation\">.</span><span class=\"token function\">addHandler</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">,</span> <span class=\"token string\">\"offline\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Offline\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"2-manifest-应用缓存\" style=\"position:relative;\"><a href=\"#2-manifest-%E5%BA%94%E7%94%A8%E7%BC%93%E5%AD%98\" aria-label=\"2 manifest 应用缓存 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. manifest 应用缓存</h3>\n<p>看下 Gatsby 的实现. 书上说的和 Gatsby 实现的方式不一样.</p>\n<ul>\n<li>gatsby-plugin-offline</li>\n<li>gatsby-plugin-manifest</li>\n</ul>\n<h3 id=\"3-cookie-相关\" style=\"position:relative;\"><a href=\"#3-cookie-%E7%9B%B8%E5%85%B3\" aria-label=\"3 cookie 相关 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Cookie 相关</h3>\n<p><strong>作用:</strong></p>\n<p>在客户端用于存储会话信息的</p>\n<p><strong>限制:</strong></p>\n<ul>\n<li>一个域下的所有 cookie 长度限制在 4095B(含)以内</li>\n<li>每个域名下 cookie 个数不超过 50 个(一般最大)</li>\n<li>每次请求会携带 cookie, 不建议存储大信息量</li>\n<li>cookie 不会区分大小写, 内部”名称”, “值”都是经过 URL 编码的</li>\n</ul>\n<p><strong>组成:</strong></p>\n<p>名称, 值, 域, 路径, 失效时间, 安全标志</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">name=value; expires=Mon, 22-Jan-07 07:10:24 GMT; domain=.wrox.com\nname=value; domain=.wrox.com; path=/; secure\n\n// 格式\nname=value; expires=expiration_time; path=domain_path;\ndomain=domain_name; secure;</code></pre></div>\n<p><strong>注意:</strong></p>\n<ul>\n<li>域、路径、失效时间和 secure 标志<strong>都是服务器给浏览器的指示</strong>，以指定何时应该发送 cookie。</li>\n<li>这些参数并不会作为发送到服务器的 cookie 信息的一部分，<strong>只有名值对儿才会被发送</strong>。</li>\n</ul>\n<p><strong>获取:</strong></p>\n<p><code class=\"language-text\">document.cookie</code> 返回当前页面<strong>可用的</strong>（根据 cookie 的域、路径、失效时间和安全设置）所有 cookie 的字符串，一系列由分号隔开的名值对儿.</p>\n<p><strong>设置格式:</strong></p>\n<p>name=value; expires=expiration<em>time; path=domain</em>path; domain=domain_name; secure</p>\n<p><strong>HTTP 专有 cookie(HTTP only)</strong></p>\n<p>可以从浏览器或者服务器设置，但<strong>是只能从服务器端读取</strong>，因为 JavaScript 无法获取 HTTP 专有 cookie 的值。</p>\n<p>HTTPOnly 是一个方式 XSS 的手段, 是不再允许出现 js 操作 cookie 的场景了，但是自己也没法儿使用 js 操作 cookie 了. 会造成使用上和迁移上的麻烦.</p>\n<p><strong>javaEE 服务端这样设置:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">response<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Set-Cookie\"</span><span class=\"token punctuation\">,</span> \"cookiename<span class=\"token operator\">=</span>value<span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Path</span><span class=\"token operator\">=</span><span class=\"token operator\">/</span><span class=\"token punctuation\">;</span><span class=\"token class-name\">Domain</span><span class=\"token operator\">=</span>domainvalue<span class=\"token punctuation\">;</span><span class=\"token class-name\">Max</span><span class=\"token operator\">-</span><span class=\"token class-name\">Age</span><span class=\"token operator\">=</span>seconds<span class=\"token punctuation\">;</span><span class=\"token class-name\">HTTPOnly</span>\"<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"4-sessionstorage-localstorage\" style=\"position:relative;\"><a href=\"#4-sessionstorage-localstorage\" aria-label=\"4 sessionstorage localstorage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. sessionStorage, localStorage</h3>\n<ul>\n<li>storage 事件, 用于跨 tab 通信</li>\n<li>5MB 存储限制</li>\n</ul>\n<h3 id=\"5-如果-cookie-中未设置过期时间会如何\" style=\"position:relative;\"><a href=\"#5-%E5%A6%82%E6%9E%9C-cookie-%E4%B8%AD%E6%9C%AA%E8%AE%BE%E7%BD%AE%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4%E4%BC%9A%E5%A6%82%E4%BD%95\" aria-label=\"5 如果 cookie 中未设置过期时间会如何 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 如果 cookie 中未设置过期时间会如何?</h3>\n<p>服务器设置的 cookie 只在当期会话有效, 关闭浏览器后删除对应 cookie.</p>\n<h3 id=\"6-js-本地操作-cookie-的处理流程有哪些\" style=\"position:relative;\"><a href=\"#6-js-%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C-cookie-%E7%9A%84%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E6%9C%89%E5%93%AA%E4%BA%9B\" aria-label=\"6 js 本地操作 cookie 的处理流程有哪些 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. JS 本地操作 cookie 的处理流程有哪些?</h3>\n<p>一般分为: <code class=\"language-text\">get()</code> / <code class=\"language-text\">set()</code> / <code class=\"language-text\">remove()</code></p>\n<p><strong><code class=\"language-text\">get(name)</code></strong></p>\n<blockquote>\n<p><strong>注意<code class=\"language-text\">name</code>需要<code class=\"language-text\">encodeURIComponent</code>处理, 返回的值需要<code class=\"language-text\">decodeURIComponent</code></strong></p>\n</blockquote>\n<ul>\n<li>找到<code class=\"language-text\">name</code>的 startIndex</li>\n<li>从 index 开始找结尾标志<code class=\"language-text\">;</code>的 endIndex, 如果未找到则到了 cookie 末端, endIndex 为 cookie 字符串长度</li>\n<li>根据起止位置用 <code class=\"language-text\">substring(startIndex+name.length, endIndex)</code> 截取字符串返回</li>\n</ul>\n<p><strong><code class=\"language-text\">set(name, value, expires, path, domain, secure)</code></strong></p>\n<blockquote>\n<p>设置 cookie 可以不用管原先已存储的值, 如果浏览器中 cookie 已存在则覆盖, 不存在则新增, 我们只需要传递修改的字符串即可</p>\n</blockquote>\n<ul>\n<li>将<code class=\"language-text\">name</code>和<code class=\"language-text\">value</code>进行<code class=\"language-text\">encodeURIComponent</code>, 根据传入的配置拼接字符串</li>\n<li>将值转给<code class=\"language-text\">document.cookie</code></li>\n</ul>\n<p><strong><code class=\"language-text\">remove(key, options)</code></strong></p>\n<blockquote>\n<p>cookie 不可以删除, 需要使用相同的路径、域和安全选项再次设置 cookie，并将失效时间设置为过去的时间。</p>\n</blockquote>\n<p>等效代码:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> domain<span class=\"token punctuation\">,</span> secure<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"7-sessionstorage-和-localstorage-使用的差别？\" style=\"position:relative;\"><a href=\"#7-sessionstorage-%E5%92%8C-localstorage-%E4%BD%BF%E7%94%A8%E7%9A%84%E5%B7%AE%E5%88%AB%EF%BC%9F\" aria-label=\"7 sessionstorage 和 localstorage 使用的差别？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. sessionStorage 和 localStorage 使用的差别？</h3>\n<ul>\n<li>sessionStorage 中的数据在<strong>当前会话期</strong>存在，而 localStorage 则一直存在</li>\n<li><strong>localStorage 中新增数据可以在其他 Tab 中同步</strong>，但是 sessionStorage 不会同步</li>\n</ul>","timeToRead":4,"wordCount":{"paragraphs":50,"sentences":52,"words":194},"fields":{"slug":"/di-er-shi-san-zhang/","relativePath":"2018/2018-03-18---di-er-shi-san-zhang/index.md"},"excerpt":"1. 如何判断在线状态? 属性: 事件: 2. manifest 应用缓存 看下 Gatsby 的实现. 书上说的和 Gatsby 实现的方式不一样. gatsby-plugin-offline gatsby…","frontmatter":{"title":"第二十三章 离线应用与客户端存储","date":"18 Mar 2018","tags":["JS高程"],"cover":"","comments":true,"author":"烈风裘"}},"prevPost":{"html":"<h3 id=\"1-xmlhttprequestd-对象发送请求的步骤-使用code-classlanguage-textgetcode和code-classlanguage-textpostcode方法举例\" style=\"position:relative;\"><a href=\"#1-xmlhttprequestd-%E5%AF%B9%E8%B1%A1%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E7%9A%84%E6%AD%A5%E9%AA%A4-%E4%BD%BF%E7%94%A8code-classlanguage-textgetcode%E5%92%8Ccode-classlanguage-textpostcode%E6%96%B9%E6%B3%95%E4%B8%BE%E4%BE%8B\" aria-label=\"1 xmlhttprequestd 对象发送请求的步骤 使用code classlanguage textgetcode和code classlanguage textpostcode方法举例 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. XMLHttpRequestd 对象发送请求的步骤, 使用<code class=\"language-text\">get</code>和<code class=\"language-text\">post</code>方法举例?</h3>\n<ol>\n<li>创建 xhr 实例</li>\n<li>open 一个请求</li>\n<li>设置 header</li>\n<li>send 请求</li>\n<li>如果满足条件可以 abort</li>\n</ol>\n<p><strong>get()同步示例:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> xhr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"example.txt\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token function\">setRequestHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MyHeader\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MyValue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">>=</span> <span class=\"token number\">200</span> <span class=\"token operator\">&amp;&amp;</span> xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">&lt;</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">==</span> <span class=\"token number\">304</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Request was unsuccessful: \"</span> <span class=\"token operator\">+</span> xhr<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>get()异步示例:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> xhr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onreadystatechange</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>readyState <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">>=</span> <span class=\"token number\">200</span> <span class=\"token operator\">&amp;&amp;</span> xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">&lt;</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">==</span> <span class=\"token number\">304</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Request was unsuccessful: \"</span> <span class=\"token operator\">+</span> xhr<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nxhr<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"example.txt\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token function\">setRequestHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MyHeader\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MyValue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>post()示例:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> xhr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onreadystatechange</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>readyState <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">>=</span> <span class=\"token number\">200</span> <span class=\"token operator\">&amp;&amp;</span> xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">&lt;</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">==</span> <span class=\"token number\">304</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Request was unsuccessful: \"</span> <span class=\"token operator\">+</span> xhr<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nxhr<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"postexample.php\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 模拟表单</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token function\">setRequestHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"application/x-www-form-urlencoded\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> form <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user-info\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>注意点:</strong></p>\n<ul>\n<li>如果是相对路径, 则 URL 相对于执行代码的当前页面</li>\n<li>调用** <code class=\"language-text\">open()</code> 方法并不会真正发送请求， 而只是启动一个请求以备发送**</li>\n<li>调用 <code class=\"language-text\">send()</code> 之后，请求就会被分派到服务器</li>\n<li>通过<code class=\"language-text\">xhr.status</code>来检测返回状态, responseText 返回响应结果</li>\n<li>异步需要注册<code class=\"language-text\">xhr.onreadystatechange</code>回调, 通过<code class=\"language-text\">xhr.readyState</code>查看请求状态(0: 请求未初始化; 1: 请求已建立但未发送; 2: 请求已发送在处理; 3: 请求在处理, 数据没全部接受, 可多次触发; 4: 响应已完成;), 通过<code class=\"language-text\">xhr.status</code>判断结果状态</li>\n<li>在接收到响应之前还可以调用 <code class=\"language-text\">abort()</code> 方法来取消异步请求, 执行之后 XHR 不再触发事件.</li>\n<li>要成功发送请求头部信息，必须在调用 open()方法之后且调用 send()方法 之前调用 setRequestHeader()</li>\n<li>只有部分的浏览器头部信息可以重写, 这个和浏览器有关</li>\n<li>如果设置了超时, 则超时后会触发<code class=\"language-text\">xhr.readyState == 4</code>的状态, 但是 xhr 对象不可再访问, 建议在 try-catch 包裹</li>\n</ul>\n<h3 id=\"2-上传文件的思路是什么-如何给出进度信息\" style=\"position:relative;\"><a href=\"#2-%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E7%9A%84%E6%80%9D%E8%B7%AF%E6%98%AF%E4%BB%80%E4%B9%88-%E5%A6%82%E4%BD%95%E7%BB%99%E5%87%BA%E8%BF%9B%E5%BA%A6%E4%BF%A1%E6%81%AF\" aria-label=\"2 上传文件的思路是什么 如何给出进度信息 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 上传文件的思路是什么, 如何给出进度信息?</h3>\n<ul>\n<li>onloadstart 事件开始</li>\n<li>onprogress 事件在接收期间不断响应</li>\n</ul>\n<h3 id=\"3-解释下跨域\" style=\"position:relative;\"><a href=\"#3-%E8%A7%A3%E9%87%8A%E4%B8%8B%E8%B7%A8%E5%9F%9F\" aria-label=\"3 解释下跨域 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 解释下跨域?</h3>\n<p>当协议(protocol)/IP/端口(port)三者一个不相同就出现跨域.</p>\n<h3 id=\"4-preflight-request-是什么-跨域时发送的code-classlanguage-textoptionscode请求的原因\" style=\"position:relative;\"><a href=\"#4-preflight-request-%E6%98%AF%E4%BB%80%E4%B9%88-%E8%B7%A8%E5%9F%9F%E6%97%B6%E5%8F%91%E9%80%81%E7%9A%84code-classlanguage-textoptionscode%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8E%9F%E5%9B%A0\" aria-label=\"4 preflight request 是什么 跨域时发送的code classlanguage textoptionscode请求的原因 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Preflight Request 是什么? 跨域时发送的<code class=\"language-text\">OPTIONS</code>请求的原因?</h3>\n<p><strong>CORS</strong>（Cross-Origin Resource Sharing，跨源资源共享）背后的基本思想:</p>\n<blockquote>\n<p><strong>使用自定义的 HTTP 头部让浏览器与服务器沟通, 从而决定请求或响应是应该成功, 还是应该失败.</strong></p>\n</blockquote>\n<p>CORS 通过 Preflight Request 机制向服务器验证请求. 这种请求使用<code class=\"language-text\">OPTIONS</code>方法发送, 包含:</p>\n<ul>\n<li>Origin：与简单的请求相同。</li>\n<li>Access-Control-Request-Method：请求自身使用的方法。</li>\n<li>Access-Control-Request-Headers：（可选）自定义的头部信息，多个头部以逗号分隔。</li>\n</ul>\n<p>服务器根据发来的请求判断是否回应, 如果回应则发送下列信息:</p>\n<ul>\n<li>Access-Control-Allow-Origin：与简单的请求相同。</li>\n<li>Access-Control-Allow-Methods：允许的方法，多个方法以逗号分隔。</li>\n<li>Access-Control-Allow-Headers：允许的头部，多个头部以逗号分隔。</li>\n<li>Access-Control-Max-Age：应该将这个 Preflight 请求缓存多长时间（以秒表示）。</li>\n</ul>\n<p>为此付出的代价<strong>只是第一次发送这种请求时会多一次 HTTP 请求</strong>.</p>\n<blockquote>\n<p>注意:</p>\n<ol>\n<li>这个机制, <strong>IE 10 及更早版本</strong>都不支持</li>\n<li>这个过程一般是<strong>不携带 cookie 等信息</strong>, 除非设置<code class=\"language-text\">xhr.withCredentials=true</code></li>\n<li>如果发送的是带凭证的请求但是服务器响应中没包含这个头部, 则浏览器就不会把响应交给 JavaScript. 于是，responseText 中将是空字符串，status 的值为 0，而且会调用 onerror()事件处理程序</li>\n</ol>\n</blockquote>\n<h3 id=\"5-使用-axios-在-ie10-跨域发送code-classlanguage-textoptioncode无法携带-cookie-等验证信息怎么解决\" style=\"position:relative;\"><a href=\"#5-%E4%BD%BF%E7%94%A8-axios-%E5%9C%A8-ie10-%E8%B7%A8%E5%9F%9F%E5%8F%91%E9%80%81code-classlanguage-textoptioncode%E6%97%A0%E6%B3%95%E6%90%BA%E5%B8%A6-cookie-%E7%AD%89%E9%AA%8C%E8%AF%81%E4%BF%A1%E6%81%AF%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3\" aria-label=\"5 使用 axios 在 ie10 跨域发送code classlanguage textoptioncode无法携带 cookie 等验证信息怎么解决 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 使用 axios 在 IE10-跨域发送<code class=\"language-text\">option</code>无法携带 cookie 等验证信息怎么解决?</h3>\n<p>在 IE10-中, 当 axios 在检测到发送的是跨域请求时(非同源), 使用的是微软特殊的 XDomainRequest 而不是一般的 XMLHttpRequest 实现的, XDomainRequest 在请求时为了安全会做出以下限制:</p>\n<ul>\n<li>cookie 不会随之发送</li>\n<li>只能设置请求头部信息中的 Content-Type 字段</li>\n<li>不能访问响应头部信息</li>\n<li>只支持 GET 和 POST 请求</li>\n</ul>\n<p>因此, 在 IE10-情况下, 跨域验证只能想别的办法. 如果是其余浏览器, 需要将<code class=\"language-text\">withCredentials</code>手动设置为 true, 可以指定某个请求应该发送凭据.</p>\n<blockquote>\n<p>axios 中<code class=\"language-text\">xhr.withCredentials</code>默认为<code class=\"language-text\">false</code></p>\n</blockquote>\n<h3 id=\"6-跨域联调需要做好哪些设置\" style=\"position:relative;\"><a href=\"#6-%E8%B7%A8%E5%9F%9F%E8%81%94%E8%B0%83%E9%9C%80%E8%A6%81%E5%81%9A%E5%A5%BD%E5%93%AA%E4%BA%9B%E8%AE%BE%E7%BD%AE\" aria-label=\"6 跨域联调需要做好哪些设置 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 跨域联调需要做好哪些设置?</h3>\n<ol>\n<li>服务端需要设置好<code class=\"language-text\">Access-Control-Allow-Origin</code>规则,</li>\n<li>如果需要在<code class=\"language-text\">OPTIONS</code>发送额外验证信息, 需要开启<code class=\"language-text\">xhr.withCredentials</code>属性, 这个属性只在 IE11+上有用, 默认为<code class=\"language-text\">false</code></li>\n<li>如果是内部联调, 开发可以使用代理转发的方式避免跨域</li>\n<li>如果跨域请求并携带 cookie 验证, 服务端验证通过但客户端还是报错, 需要检查下服务端是否返回这个: <code class=\"language-text\">Access-Control-Allow-Credentials: true</code></li>\n</ol>\n<h3 id=\"7-有些网页功能只能在内网环境下工作-在外网需要隐藏-这个功能如何实现\" style=\"position:relative;\"><a href=\"#7-%E6%9C%89%E4%BA%9B%E7%BD%91%E9%A1%B5%E5%8A%9F%E8%83%BD%E5%8F%AA%E8%83%BD%E5%9C%A8%E5%86%85%E7%BD%91%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%B7%A5%E4%BD%9C-%E5%9C%A8%E5%A4%96%E7%BD%91%E9%9C%80%E8%A6%81%E9%9A%90%E8%97%8F-%E8%BF%99%E4%B8%AA%E5%8A%9F%E8%83%BD%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0\" aria-label=\"7 有些网页功能只能在内网环境下工作 在外网需要隐藏 这个功能如何实现 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. 有些网页功能只能在内网环境下工作, 在外网需要隐藏, 这个功能如何实现?</h3>\n<blockquote>\n<p>提示: 内网可能会有多个 ip/端口/内部域名, 但共同点是内网在外部都无法访问.</p>\n</blockquote>\n<p>使用图像 ping 方式. 尝试请求内网的图片, 如果成功执行<code class=\"language-text\">onload</code>回调, 如果失败执行<code class=\"language-text\">onerror</code>回调.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> img <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nimg<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nimg<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Done!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nimg<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">\"http://www.example.com/test?name=Nicholas\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"8-如何统计-jsdk-的使用信息\" style=\"position:relative;\"><a href=\"#8-%E5%A6%82%E4%BD%95%E7%BB%9F%E8%AE%A1-jsdk-%E7%9A%84%E4%BD%BF%E7%94%A8%E4%BF%A1%E6%81%AF\" aria-label=\"8 如何统计 jsdk 的使用信息 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. 如何统计 JSDK 的使用信息?</h3>\n<p>使用图像 ping 方式. 请求远程服务的 gif 图片并在 url 参数中携带使用信息.</p>\n<h3 id=\"9-jsonp-的实现方式及存在的问题\" style=\"position:relative;\"><a href=\"#9-jsonp-%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E5%8F%8A%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98\" aria-label=\"9 jsonp 的实现方式及存在的问题 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9. JSONP 的实现方式及存在的问题?</h3>\n<ul>\n<li>callback 函数需要放到 window 上(全局)</li>\n<li>外部源如果不安全会出现漏洞, XSS/CSRF 等</li>\n</ul>\n<h3 id=\"10-jsonp-和-ajax-的关系\" style=\"position:relative;\"><a href=\"#10-jsonp-%E5%92%8C-ajax-%E7%9A%84%E5%85%B3%E7%B3%BB\" aria-label=\"10 jsonp 和 ajax 的关系 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10. JSONP 和 Ajax 的关系?</h3>\n<p>两者没关系.</p>\n<p>JSONP 过程:</p>\n<ul>\n<li>创建 JS 脚本</li>\n<li>向服务端请求数据并在 url 参数中携带 callback 函数,</li>\n<li>服务器获得请求将 callback 对应的函数名与数据结合发送给客户端</li>\n<li>脚本加载完成, 客户端执行 callback 函数并处理包含的数据</li>\n</ul>\n<h3 id=\"11-comet-长轮询和短轮询的过程及问题点\" style=\"position:relative;\"><a href=\"#11-comet-%E9%95%BF%E8%BD%AE%E8%AF%A2%E5%92%8C%E7%9F%AD%E8%BD%AE%E8%AF%A2%E7%9A%84%E8%BF%87%E7%A8%8B%E5%8F%8A%E9%97%AE%E9%A2%98%E7%82%B9\" aria-label=\"11 comet 长轮询和短轮询的过程及问题点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>11. Comet, 长轮询和短轮询的过程及问题点?</h3>\n<p>有两种实现 Comet 的方式：轮询和流. 轮询分为长轮询和短轮询.</p>\n<p><strong>短轮询:</strong></p>\n<p>客户端定时发送请求.</p>\n<p><strong>长轮询:</strong></p>\n<p>客户端发送请求, 服务端有数据后再返回, 客户端接收后随即再发起请求.</p>\n<p><strong>HTTP 流</strong></p>\n<p>流不同于上述两种轮询，因为它在页面的整个生命周期内只 使用一个 HTTP 连接。服务端不断向客户端吐数据, 客户端通过<code class=\"language-text\">xhr.readyState == 3</code> 截取收到的东西, 这里说明两个接口.</p>\n<h3 id=\"12-sse-和-websockets-的区别\" style=\"position:relative;\"><a href=\"#12-sse-%E5%92%8C-websockets-%E7%9A%84%E5%8C%BA%E5%88%AB\" aria-label=\"12 sse 和 websockets 的区别 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>12. SSE 和 WebSockets 的区别</h3>\n<ul>\n<li>SSE API(服务器发送事件), IE 不支持, 使用 XHR 也可以实现</li>\n<li>Web Sockets, 使用自定义协议, 双向通信, 需要专门服务器, 使用 SSE 和 XHR 可能实现</li>\n</ul>\n<h3 id=\"13-如何保证接口安全-可用的措施是\" style=\"position:relative;\"><a href=\"#13-%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%8E%A5%E5%8F%A3%E5%AE%89%E5%85%A8-%E5%8F%AF%E7%94%A8%E7%9A%84%E6%8E%AA%E6%96%BD%E6%98%AF\" aria-label=\"13 如何保证接口安全 可用的措施是 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>13. 如何保证接口安全, 可用的措施是?</h3>\n<p>为确保通过 XHR 访问的 URL 安全，通行的做法就是验证发送请求者是否有权限访问相应的资源。 有下列几种方式可供选择</p>\n<ul>\n<li>要求以 SSL 连接来访问可以通过 XHR 请求的资源。</li>\n<li>要求每一次请求都要附带经过相应算法计算得到的验证码。</li>\n<li>都走 post 请求, 请求 body 加密(网易云音乐接口)</li>\n</ul>\n<h3 id=\"14-http-keep-alive-和-tcp-keepalive-的区别\" style=\"position:relative;\"><a href=\"#14-http-keep-alive-%E5%92%8C-tcp-keepalive-%E7%9A%84%E5%8C%BA%E5%88%AB\" aria-label=\"14 http keep alive 和 tcp keepalive 的区别 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>14. HTTP keep-alive 和 TCP keepalive 的区别?</h3>\n<h4 id=\"http-建立在-tcp-之上\" style=\"position:relative;\"><a href=\"#http-%E5%BB%BA%E7%AB%8B%E5%9C%A8-tcp-%E4%B9%8B%E4%B8%8A\" aria-label=\"http 建立在 tcp 之上 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HTTP 建立在 TCP 之上</h4>\n<p>TCP 协议对应于传输层，而 HTTP 协议对应于应用层，从本质上来说，二者没有可比性。</p>\n<h4 id=\"tcp-keepalive\" style=\"position:relative;\"><a href=\"#tcp-keepalive\" aria-label=\"tcp keepalive permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TCP keepalive</h4>\n<blockquote>\n<p><strong>保活, 心跳, 检测连接错误</strong></p>\n</blockquote>\n<p>双方建立交互的链接不一定一直存在数据交互, 期间使用保活报文探测对方是否还在. 中间过程会遇到防火墙等中间设备, 会对 TCP 保活产生影响.</p>\n<h4 id=\"http-keep-alive\" style=\"position:relative;\"><a href=\"#http-keep-alive\" aria-label=\"http keep alive permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HTTP keep-alive</h4>\n<blockquote>\n<p><strong>连接复用</strong></p>\n</blockquote>\n<p>在一个 TCP 链接上进行多次 HTTP 请求从而提高性能.</p>\n<p>Httpd 守护进程，一般都提供了 keep-alive timeout 时间设置参数. 正常情况下, 一个 HTTP 产生的 TCP 链接在传送完最后一个响应后, 马上主动关闭响应的 TCP 链接, 但是设置了 timeout 后, httpd 守护进程会等待以下, 如果还未有数据交互, 则关闭 HTTP 连接.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 840px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.38095238095238%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACbElEQVQoz2VTS2gTURQ9b77NJDOZyW9iPjWTxgTbpAVj8VO0fiKIWCsKAamlIqgYirow6MKVbtwVFQTTRRHqB8EquHQhFHWjiHWjoEJX7hRx43K8M5NJR71w571337mf8+4dwBWujz4l0gxjKYlBCQOKCTCLbAbWRHNwDIgxHiFaZSCcIv8i2dMuQnnPSeIU4sJ6bVQKV7SAs0I6AI7zbB94AedgYos4hq2bkgFciLQAiF3fT6KMR1Axu70fBTuUwKph4ZuhY7UgYUKFG9UGbkgiLTJrbjDNwrxZxA+9zL5GE/hsxXA16UXewRyM/EaAcZvlRzq4mJpGJ3oBC8ZezGV05F26iXKxV04/JlOH0Rk6wZa0k3isD+NJ0cRkugdotvlE8xSKe/ZVxmvGW8pkM+/mnkSsNZ99xsq4O5O3YgdY28jgd2Q/lpMVPN+YRivlUefTgac4pu6GLdfxKtXAy1wZyyMR7Iw7N+vQoO8ZePQn0gepwm1YSQzgu5rEgq6i7jxNlDSP11Uh+qyE7Fy8tOuBcDr5i9L4KWij+vvrMN3KZVSNo7iWmcHTaAuL0QpeVE2cdcvnEFJQu8X0ehu55HSuhpJNZdsKmB2O4F2ex2BvZH7SaFFr9PvQBu+gkXVsK7jMn6f2Rmh2KL3ikvFlBoesS7ibnsK8MYtFYzMeWhEMx7zbMdykobRpVMdpBkMBFnQUqDa1S0WgV+OUjwLMJd4Y+sKOy1dwhLPR6jbGyezz5romjioxAs/C8z4uIILk/CV/WaARiGW9E3On19shT9oXgMpuM/4RFgbvBMUo0fNLIRXxv4he3DXfIO4PaLRglUXbJz4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"HTTP Keep-Alive模型\"\n        title=\"HTTP Keep-Alive模型\"\n        src=\"/blog/static/8f6f66911ea7769142c4501ce2a1e455/f88f5/keep-alive.png\"\n        srcset=\"/blog/static/8f6f66911ea7769142c4501ce2a1e455/e1650/keep-alive.png 210w,\n/blog/static/8f6f66911ea7769142c4501ce2a1e455/8cae7/keep-alive.png 420w,\n/blog/static/8f6f66911ea7769142c4501ce2a1e455/f88f5/keep-alive.png 840w,\n/blog/static/8f6f66911ea7769142c4501ce2a1e455/1084e/keep-alive.png 1000w\"\n        sizes=\"(max-width: 840px) 100vw, 840px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">HTTP Keep-Alive模型</figcaption>\n  </figure></p>\n<p>HTTP1.0 中默认是关闭的，需要在 HTTP 头加入”Connection: Keep-Alive”，才能启用 Keep-Alive；HTTP1.1 中默认启用 Keep-Alive，加入”Connection: close “，才关闭。</p>\n<h4 id=\"两者的关系\" style=\"position:relative;\"><a href=\"#%E4%B8%A4%E8%80%85%E7%9A%84%E5%85%B3%E7%B3%BB\" aria-label=\"两者的关系 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>两者的关系</h4>\n<p>http keep-alive 与 tcp keep-alive，不是同一回事，意图不一样。http keep-alive 是为了让 tcp 活得更久一点，以便在同一个连接上传送多个 http，提高 socket 的效率。而 tcp keep-alive 是 TCP 的一种检测 TCP 连接状况的保鲜机制。</p>\n<h4 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h4>\n<ul>\n<li><a href=\"https://www.cnblogs.com/laowenBlog/p/6096239.html\" target=\"_target\" rel=\"nofollow\">HTTP Keep-Alive 模式</a></li>\n<li><a href=\"https://www.jianshu.com/p/e99e0e505c79\" target=\"_target\" rel=\"nofollow\">Http keep-alive 分析</a></li>\n</ul>","timeToRead":11,"wordCount":{"paragraphs":102,"sentences":111,"words":476},"fields":{"slug":"/di-er-shi-yi-zhang/","relativePath":"2018/2018-03-20---di-er-shi-yi-zhang/index.md"},"excerpt":"1. XMLHttpRequestd 对象发送请求的步骤, 使用和方法举例? 创建 xhr 实例 open 一个请求 设置 header send 请求 如果满足条件可以 abort get()同步示例: get…","frontmatter":{"title":"第二十一章 Ajax与Comet","date":"20 Mar 2018","tags":["JS高程"],"cover":"","comments":true,"author":"烈风裘"}}},"pageContext":{"curr":"/di-shi-qi-zhang-cuo/","prev":"/di-er-shi-yi-zhang/","next":"/di-er-shi-san-zhang/"}},"staticQueryHashes":["3240721340","63159454"]}