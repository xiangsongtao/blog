{"componentChunkName":"component---src-templates-blog-post-js","path":"/qian-duan-dai-ma-yi-chang-jian-kong/","result":{"data":{"site":{"siteMetadata":{"title":"Attila","cover":"/background/1.jpg","description":"Thoughts, stories and ideas.","keywords":["烈风裘的博客","X-Blog","Attila","Gatsby","前端成长记录"],"tagCover":"/background/5.jpg","archiveCover":"/background/escape-flight.png","siteUrl":"https://xiangst0816.github.io/blog","logo":"","navigation":true,"subscribe":true}},"allAuthorJson":{"totalCount":2,"edges":[{"node":{"id":"烈风裘","bio":"一往无前, 直到云开雾散!","avatar":"/avatar/avatar.png","cover":"/background/photo-1503197979108-c824168d51a8.jpeg","github":"https://github.com/xiangst0816","twitter":"","zhihu":"","weibo":"","facebook":"","website":"https://xiangst0816.github.io/blog/","location":"HangZhou, China"}},{"node":{"id":"WALL-E","bio":"还有要清理的吗?","avatar":"/avatar/cleaner.jpg","cover":"","github":null,"twitter":null,"zhihu":null,"weibo":null,"facebook":null,"website":null,"location":"Earth"}}]},"master":{"id":"烈风裘","bio":"一往无前, 直到云开雾散!","avatar":"/avatar/avatar.png","cover":"/background/photo-1503197979108-c824168d51a8.jpeg","github":"https://github.com/xiangst0816","twitter":"","zhihu":"","weibo":"","facebook":"","website":"https://xiangst0816.github.io/blog/","location":"HangZhou, China"},"currentPost":{"html":"<p>最近在做 VImo 前端 Hybrid 框架编写，基础组件完成的差不多了，在组件模块之外还需要一个日志模块，关于日志模块的设计先从需求开始(自己给自己找需求)，大概是这样：在手机模式下，希望能有一个将代码中以 console 打印出来的信息显示在这个界面上的模块，包括 log、error、warn 等信息， 这样方便在手机上调试能看到错误信息，或者是 log 信息。</p>\n<p>因此，第一版的做法估计大家都会，拦截 console 方法， 将 arguments 信息转存到一个数组，然后将数组中的数据显示在这个界面上。界面用 js 动态生成，然后内容 append 到 body 里面就好，难度不大。</p>\n<p>但是，仔细一想，这个是有问题的：既然我都拦截了 console，如果我想统计 error 信息，并将错误信息发送到异常监控平台，也许又是一顿改；或者 PM 给了另一个需求：将监控用户行为的代码埋点发送到处理埋点的平台，也许又要加班了。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">try{\n\thelloWord()\n}catch(err){\n\tsendReport(err)\n}\n\nvar res = {\n\t// ...\n\tfail:function(){\n\t\tconsole.error(&#39;Can not find data! getUser.js::&lt;Function&gt;findMethod&#39;)\n\t}\n}</code></pre></div>\n<p>这里需要解释下埋点，乍一看，这个好像和拦截 console 没关系，我们需要换个角度来看下：一般定制化的统计都是需要定向埋点的，这就需要监听目标位置触发的事件，然后执行埋点程序，像下面这样：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$here.click(function(){\n\tuserEvent.send(&#39;hereClick-1&#39;)\n})</code></pre></div>\n<p>发送使用的是 ajax 还是图片这个由业务自己选择，本质上也是一个单向的数据传递，这个和发送页面异常信息是一样，可以理解成“我埋了一个错误”，呵呵。</p>\n<p>将共性提取出来，就是下面这个的图：</p>\n<p><img src=\"\"></p>\n<p>我们可以将网页看做一个分布式不连续的类 App 应用，当然，SPA 单页应用会更纯粹一些。应用对外信息操作分为两类：</p>\n<ol>\n<li>双向通信：比如 Ajax 数据请求，或者发送数据</li>\n<li>单向传递状态信息：错误异常监控、埋点等</li>\n</ol>\n<p>因此，这里涉及的日志模块就是为第二类准备的，功能清单如下：</p>\n<ol>\n<li>拦截 console 方法，如果是 error、warn、assert 方法则提取错误信息，一般为 string</li>\n<li>$log 服务添加自定义的 error、warn、assert 方法，可以传递更为复杂的错误对象</li>\n<li>对传入的错误信息进行归一化，try/catch 和 onerror 的错误属性是不一样的，这里需要统一</li>\n<li>埋点的实现方法和$log 完全相同</li>\n</ol>\n<p>将前端的代码当做一个分布式的类 App</p>\n<h2 id=\"app-对外通信方式\" style=\"position:relative;\"><a href=\"#app-%E5%AF%B9%E5%A4%96%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F\" aria-label=\"app 对外通信方式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>App 对外通信方式</h2>\n<h3 id=\"http-请求\" style=\"position:relative;\"><a href=\"#http-%E8%AF%B7%E6%B1%82\" aria-label=\"http 请求 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>http 请求</h3>\n<h3 id=\"app-日志\" style=\"position:relative;\"><a href=\"#app-%E6%97%A5%E5%BF%97\" aria-label=\"app 日志 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>App 日志</h3>\n<p>普通日志(log/debug/info)+异常日志(error/assert/warn)+埋点信息(analystics)</p>\n<p>移动端需要将日志搜集显示在手机屏幕上的需求</p>\n<p>普通的日志使用方式(显示级别不一样):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$log.log(&#39;message&#39;);\n$log.info(&#39;message&#39;);\n$log.debug(&#39;message&#39;);</code></pre></div>\n<p>异常的日志使用方式:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$log.warn(&#39;message&#39;, &#39;position&#39;);\n$log.error(&#39;message&#39;, &#39;position&#39;);\n$log.assert(isFalse, &#39;message&#39;, &#39;position&#39;);\n$log.assert(isFalse, &#39;message&#39;, &#39;./src/test.js::&lt;Function&gt;testMethod&#39;);</code></pre></div>\n<h2 id=\"异常搜集方式\" style=\"position:relative;\"><a href=\"#%E5%BC%82%E5%B8%B8%E6%90%9C%E9%9B%86%E6%96%B9%E5%BC%8F\" aria-label=\"异常搜集方式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>异常搜集方式</h2>\n<h3 id=\"主动发送\" style=\"position:relative;\"><a href=\"#%E4%B8%BB%E5%8A%A8%E5%8F%91%E9%80%81\" aria-label=\"主动发送 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>主动发送</h3>\n<p>用于逻辑错误或状态错误.</p>\n<p>在代码中的异常位置手写记录代码:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n\tfail:function(){\n\t\t$log.error(&#39;无法得到服务器数据&#39;, &#39;./src/test.js &lt;Function&gt;testMethod&#39;)\n\t}\n}</code></pre></div>\n<h3 id=\"trycatch\" style=\"position:relative;\"><a href=\"#trycatch\" aria-label=\"trycatch permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>try/catch</h3>\n<p>能不捕获的异常有 7 类,:</p>\n<ol>\n<li>SyntaxError: 语法错误</li>\n<li>ReferenceError: 引用错误 要用的东西没找到</li>\n<li>RangeError: 范围错误 专指参数超范围</li>\n<li>TypeError: 类型错误 错误的调用了对象的方法</li>\n<li>EvalError: eval()方法错误的使用与 url 相关函数参数不正确，主要是 encodeURI()、decodeURI()、\nencodeURIComponent()、decodeURIComponent()、escape()和 unescape()这六个函数。\neg: decodeURI(‘%2’)\nUncaught URIError: URI malformed</li>\n<li>URIError: url 地址错误\neval 函数没有被正确执行</li>\n<li>执行 ifream 中的方法</li>\n<li>json.parse()</li>\n<li>外部定义的变量, 比如 hrbyid 中定义的全局属性及方法</li>\n</ol>\n<p>1-4 在开发过程中避免,\n5-8 需要代码运行时判断(try/catch)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">try{\n\t// ....code\n}catch(err){\n\t$log.error(&#39;无法执行代码&#39;, &#39;./src/test.js::&lt;Function&gt;testMethod&#39;, err)\n}</code></pre></div>\n<h3 id=\"windowonerror\" style=\"position:relative;\"><a href=\"#windowonerror\" aria-label=\"windowonerror permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>window.onerror</h3>\n<h2 id=\"异常搜集问题点\" style=\"position:relative;\"><a href=\"#%E5%BC%82%E5%B8%B8%E6%90%9C%E9%9B%86%E9%97%AE%E9%A2%98%E7%82%B9\" aria-label=\"异常搜集问题点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>异常搜集问题点</h2>\n<ol>\n<li>Script error 跨域问题. -> “Script error.“,</li>\n<li>try/catch, window.onerror -> 压缩代码无法定位(由本地$log 接管封装)</li>\n<li>window.onerror 只能有一个</li>\n<li>采样率(大 PV 的情况下)</li>\n<li>try/catch, window.onerror 返回的参数需要归一化</li>\n<li>error 不同途径的参数丢失</li>\n<li>message 在 console 中的展示形式</li>\n</ol>\n<h2 id=\"支持单页-spa-也支持多页\" style=\"position:relative;\"><a href=\"#%E6%94%AF%E6%8C%81%E5%8D%95%E9%A1%B5-spa-%E4%B9%9F%E6%94%AF%E6%8C%81%E5%A4%9A%E9%A1%B5\" aria-label=\"支持单页 spa 也支持多页 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>支持单页 SPA 也支持多页</h2>\n<p>localstroage 中备份, 初始化时先检查是否有备份. 注意 3Mb 的限制</p>\n<h2 id=\"关于埋点\" style=\"position:relative;\"><a href=\"#%E5%85%B3%E4%BA%8E%E5%9F%8B%E7%82%B9\" aria-label=\"关于埋点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>关于埋点</h2>\n<p>这里使用的是定向侵入式埋点.</p>\n<p>这类的埋点都是由事件触发: performance/pointer(click/touch)/scroll/setTimeout/自定义(swiper/goBack/appLoad/appExit/), 触发之后发送 log 信息:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$analytics(&#39;type&#39;, id)</code></pre></div>\n<p>如果是 pointer 类事件, 则在 dom 中添加属性: data-analytics-id=”_id”, _id 这部分可以通过 Vuex 全局维护(类似于 i18n)</p>","timeToRead":5,"wordCount":{"paragraphs":53,"sentences":55,"words":273},"fields":{"slug":"/qian-duan-dai-ma-yi-chang-jian-kong/","relativePath":"2017/2017-03-9---qian-duan-dai-ma-yi-chang-jian-kong/index.md"},"excerpt":"最近在做 VImo 前端 Hybrid…","frontmatter":{"title":"前端代码异常监控模块设计","date":"09 Mar 2017","tags":["前端监控"],"cover":"","comments":true,"author":"烈风裘"}},"nextPost":{"html":"<p>Vimo 是一个移动端混合框架的解决方案，包含了移动设备平台信息的初始化置、基础 H5 组件及 HyBrid 组件的注册安装、公共方法包装等。决定要写这个框架也是因为自己去年一年的工作需要做个总结，故以此为载体，将我对 H5 移动端的理解及认识总结在里面。</p>\n<p>Vimo 是 VueMobile 的昵称，也是名字的由来，代表他是基于 Vue.js 为基础实现的。对于框架的开发，我自认为我对框架前瞻性思维和经验还是不足，借鉴与学习也许就是我现在最该着手去做的。因为开发过 IONIC 应用，认为 IONIC 在处理组件传参指纹、平台特性初始化等方面做得很好，所以就以此为蓝图进行模仿。因此，在阅读 Vimo 源码的时候应该能看到很多 IONIC 的身影。</p>\n<p>我相信每个致力于技术方向的开发人员心里面都会有一个金字塔，金字塔的底部就是自己领域的知识积累，中间是经验与技巧，最上面应该就要实现自己的知识体系与框架思想。VImo 就是一个我的一个 Top，在开发完“杭州公交 H5”项目后，认识到这个过程是必须要走的。</p>\n<blockquote>\n<p>也是为了在框架的基础上快开发，避免不必要的设计麻烦，节省时间多陪陪家人。</p>\n</blockquote>\n<p>关于 Vimo 接下来的介绍，我将以问题的形式进行：</p>\n<h2 id=\"1-什么是混合框架-设计的目的是什么\" style=\"position:relative;\"><a href=\"#1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%B7%B7%E5%90%88%E6%A1%86%E6%9E%B6-%E8%AE%BE%E8%AE%A1%E7%9A%84%E7%9B%AE%E7%9A%84%E6%98%AF%E4%BB%80%E4%B9%88\" aria-label=\"1 什么是混合框架 设计的目的是什么 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 什么是混合框架, 设计的目的是什么?</h2>\n<p>设计的目的：便于在各个系统(网页/平台/壳子)中都能步调一致的工作，将不同的部分抽离出页面，也便于调试！</p>\n<h2 id=\"问题搜集\" style=\"position:relative;\"><a href=\"#%E9%97%AE%E9%A2%98%E6%90%9C%E9%9B%86\" aria-label=\"问题搜集 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>问题搜集</h2>\n<p><strong>什么是混合框架, 设计的目的是什么?</strong></p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">纯 H5 实现</th>\n<th align=\"center\">纯 App 方案</th>\n<th align=\"center\">HyBrid 方案</th>\n<th align=\"center\">类 ReactNative 方案</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">效率高, 性能低</td>\n<td align=\"center\">效率低, 性能高, 灵活性低</td>\n<td align=\"center\">折中, 需要 bridge</td>\n<td align=\"center\">特殊业务需要定制化开发插件</td>\n</tr>\n</tbody>\n</table>\n<p>设计的目的：便于在各个系统(网页/平台/壳子)中都能步调一致的工作，将不同的部分抽离出页面，也便于调试！</p>\n<p>现在的一种这种方案:</p>\n<ul>\n<li>Vimo 设计思路来源于 IONIC, 为何选用 Vue 重构?</li>\n<li>IONIC 的设计可以借鉴学习, 我对 vue 比较熟, 简单+快</li>\n<li>IONIC Angular2.x + Typescript 陡峭+维护复杂</li>\n<li>react 不熟, 但是从测试角度来看, vue 稍强</li>\n<li>组件间嵌套规则是怎样的, 公共服务是如何注册到 this 上的? 为何要这样做?</li>\n</ul>\n<p>App -> Nav -> | Page | -> Header/Content/Footer</p>\n<p>覆盖大多数场景的布局结构</p>\n<ul>\n<li>各个模块的作用介绍, 和简单的实现思路?</li>\n</ul>\n<p>App: 主体\nNav: 路由切换的 wrap, 动画部分\nPage: 业务页面</p>\n<ul>\n<li>从我的角度来看你 Vimo 的不足和需要改进的地方</li>\n<li>计划: IONIC 的皮肤+ vue 的核心, 展示 IOS/md/wp/wechat/ali/cus</li>\n<li>只需要一个主题</li>\n<li>IONIC 实现有些复杂, 有些代码没看懂</li>\n<li>组件主要依据功能清单写的.</li>\n<li>对 test 支持</li>\n<li>hybrid 如何进行安装的由 hybrid 自己安装</li>\n</ul>\n<p>改进的地方：</p>\n<ol>\n<li>没实际的项目测试及运用，</li>\n<li>关于样式的处理，计划简单点, 例如只支持 IOS 的</li>\n<li>设计大多数是向类杭州公交【富 APP】方向靠，如果对单个页面的业务支持需要再改版.</li>\n<li>列表组件及附属组件有些事不必要的. 需要剔除</li>\n</ol>","timeToRead":3,"wordCount":{"paragraphs":32,"sentences":34,"words":164},"fields":{"slug":"/Vimo-jie-shao/","relativePath":"2017/2017-02-23---Vimo-jie-shao/index.md"},"excerpt":"Vimo 是一个移动端混合框架的解决方案，包含了移动设备平台信息的初始化置、基础 H5 组件及 HyBrid…","frontmatter":{"title":"Vimo介绍","date":"23 Feb 2017","tags":["Vue","Vimo"],"cover":"","comments":true,"author":"烈风裘"}},"prevPost":{"html":"<p>出现这个问题是因为我在排查 Toast 组的代码中, 发现现在的 API 调用感觉不够清晰, 有点像老奶奶的裹脚布一样长, 想修改但是不知道如何改.</p>\n<p>这里参看了很多相同组件的 API 设计, 百花齐放, 我也不知道该怎么办了.</p>\n<p>这里找了一篇文章说的挺好: <a href=\"http://www.woshipm.com/operate/32612.html\" target=\"_target\" rel=\"nofollow\">如何设计一个优秀的 API</a> , 可以参考下!</p>\n<h2 id=\"原则\" style=\"position:relative;\"><a href=\"#%E5%8E%9F%E5%88%99\" aria-label=\"原则 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>原则</h2>\n<h3 id=\"对于用户\" style=\"position:relative;\"><a href=\"#%E5%AF%B9%E4%BA%8E%E7%94%A8%E6%88%B7\" aria-label=\"对于用户 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>对于用户:</h3>\n<ol>\n<li>易学习：有完善的文档及提供尽可能多的示例和可 copy－paste 的代码，像其他设计工作一样，你应该应用最小惊讶原则。</li>\n<li>易使用：没有复杂的程序、复杂的细节，易于学习；灵活的 API 允许按字段排序、可自定义分页、 排序和筛选等。一个完整的 API 意味着被期望的功能都包含在内。</li>\n<li>难误用：对详细的错误提示，有些经验的用户可以直接使用 API 而不需要阅读文档。</li>\n</ol>\n<h3 id=\"对于开发者\" style=\"position:relative;\"><a href=\"#%E5%AF%B9%E4%BA%8E%E5%BC%80%E5%8F%91%E8%80%85\" aria-label=\"对于开发者 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>对于开发者:</h3>\n<ol>\n<li>易阅读：代码的编写只需要一次一次，但是当调试或者修改的时候都需要对代码进行阅读。</li>\n<li>易开发：个最小化的接口是使用尽可能少的类以及尽可能少的类成员。这样使得理解、记忆、调试以及改变 API 更容易。</li>\n</ol>\n<h2 id=\"开发\" style=\"position:relative;\"><a href=\"#%E5%BC%80%E5%8F%91\" aria-label=\"开发 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>开发</h2>\n<ol>\n<li>站在用户的角度</li>\n<li>后续的需求能拓展</li>\n<li>尽量少的做事儿是抑制 API 设计错误的有效方案</li>\n<li>对外文档清晰和规范,</li>\n<li>方法优于属性</li>\n<li>工厂方法优于构造函数</li>\n<li>避免过多继承</li>\n<li>避免由于优化或者复用代码影响 API</li>\n<li>面向接口编程</li>\n<li>扩展参数应当是便利的</li>\n<li>对组件进行合理定位，确定暴露多少接口</li>\n<li>提供扩展点</li>\n</ol>","timeToRead":2,"wordCount":{"paragraphs":24,"sentences":24,"words":71},"fields":{"slug":"/ru-he-she-ji-zu-jian-de-di-API/","relativePath":"2017/2017-03-19---ru-he-she-ji-zu-jian-de-di-API/index.md"},"excerpt":"出现这个问题是因为我在排查 Toast 组的代码中, 发现现在的 API 调用感觉不够清晰, 有点像老奶奶的裹脚布一样长, 想修改但是不知道如何改. 这里参看了很多相同组件的 API…","frontmatter":{"title":"如何设计组件的API","date":"19 Mar 2017","tags":["思考"],"cover":"","comments":true,"author":"烈风裘"}}},"pageContext":{"curr":"/qian-duan-dai-ma-yi-chang-jian-kong/","prev":"/ru-he-she-ji-zu-jian-de-di-API/","next":"/Vimo-jie-shao/"}},"staticQueryHashes":["3240721340","63159454"]}